% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class-attachment-index.R
\name{AttachmentIndex}
\alias{AttachmentIndex}
\title{Attachment Index for Workflow Result Tracking}
\description{
R6 class that manages the attachment index for workflow
execution. Backed by \pkg{RSQLite}, this class provides atomic,
query-friendly tracking of attachment \verb{lifecycle} status. All database
access uses open/close-per-operation pattern for safety.
}
\details{
The index tracks each attachment through its \verb{lifecycle}:
\describe{
\item{\code{init}}{Runtime created, execution not yet started}
\item{\code{running}}{Agent execution in progress}
\item{\code{finished}}{Execution completed successfully}
\item{\code{errored}}{Execution completed with error}
\item{\code{skipped}}{Execution was skipped (reserved for future use)}
}
\subsection{Backend Abstraction}{

All \code{SQLite} calls are isolated behind the private
\code{$.with_db()} method. To swap backends (e.g., \pkg{duckdb}),
only \code{$.with_db()} and \code{$.init_db()} need modification.
}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-TricobblerAttachmentIndex-new}{\code{AttachmentIndex$new()}}
\item \href{#method-TricobblerAttachmentIndex-register}{\code{AttachmentIndex$register()}}
\item \href{#method-TricobblerAttachmentIndex-update_status}{\code{AttachmentIndex$update_status()}}
\item \href{#method-TricobblerAttachmentIndex-mark_finished}{\code{AttachmentIndex$mark_finished()}}
\item \href{#method-TricobblerAttachmentIndex-get}{\code{AttachmentIndex$get()}}
\item \href{#method-TricobblerAttachmentIndex-list}{\code{AttachmentIndex$list()}}
\item \href{#method-TricobblerAttachmentIndex-query}{\code{AttachmentIndex$query()}}
\item \href{#method-TricobblerAttachmentIndex-list_incomplete}{\code{AttachmentIndex$list_incomplete()}}
\item \href{#method-TricobblerAttachmentIndex-exists}{\code{AttachmentIndex$exists()}}
\item \href{#method-TricobblerAttachmentIndex-get_db_path}{\code{AttachmentIndex$get_db_path()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-new"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-new}{}}}
\subsection{Method \code{new()}}{
Initialize the attachment index
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$new(db_path)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{db_path}}{character, path to the SQLite database file}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-register"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-register}{}}}
\subsection{Method \code{register()}}{
Register a new attachment entry with status 'init'
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$register(attachment_id, stage, state, agent_id, attempt = 0L)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{attachment_id}}{character, unique attachment identifier}

\item{\code{stage}}{character, stage name}

\item{\code{state}}{character, state name}

\item{\code{agent_id}}{character, agent identifier}

\item{\code{attempt}}{integer, attempt number}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-update_status"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-update_status}{}}}
\subsection{Method \code{update_status()}}{
Update the status of an existing attachment
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$update_status(attachment_id, status)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{attachment_id}}{character, attachment identifier}

\item{\code{status}}{character, new status}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-mark_finished"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-mark_finished}{}}}
\subsection{Method \code{mark_finished()}}{
Mark an attachment as finished or \verb{errored}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$mark_finished(attachment_id, succeed)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{attachment_id}}{character, attachment identifier}

\item{\code{succeed}}{logical, whether execution succeeded}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-get"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-get}{}}}
\subsection{Method \code{get()}}{
Retrieve a single index entry
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$get(attachment_id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{attachment_id}}{character, attachment identifier}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A single-row data.frame or \code{NULL} if not found
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-list"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-list}{}}}
\subsection{Method \code{list()}}{
List all index entries
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$list(status = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{status}}{character or \code{NULL}, optional status filter}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame of all matching entries (most recent first)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-query"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-query}{}}}
\subsection{Method \code{query()}}{
Query index entries by state and/or stage
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$query(state, stage = NULL, status = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{state}}{character, state name to filter by}

\item{\code{stage}}{character or \code{NULL}, optional stage filter}

\item{\code{status}}{character or \code{NULL}, optional status filter}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame of matching entries (most recent first)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-list_incomplete"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-list_incomplete}{}}}
\subsection{Method \code{list_incomplete()}}{
Find incomplete entries (init or running past timeout)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$list_incomplete(timeout_secs = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{timeout_secs}}{numeric, seconds after which init/running entries
are considered incomplete. If \code{NULL} (default), returns all
entries with status 'init' or 'running' regardless of age.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.frame of incomplete entries
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-exists"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-exists}{}}}
\subsection{Method \code{exists()}}{
Check if an attachment exists in the index
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$exists(attachment_id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{attachment_id}}{character, attachment identifier}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
logical
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-TricobblerAttachmentIndex-get_db_path"></a>}}
\if{latex}{\out{\hypertarget{method-TricobblerAttachmentIndex-get_db_path}{}}}
\subsection{Method \code{get_db_path()}}{
Get the database file path
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{AttachmentIndex$get_db_path()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
character, path to the SQLite database
}
}
}

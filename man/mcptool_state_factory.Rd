% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mcp-state.R
\name{mcptool_state_factory}
\alias{mcptool_state_factory}
\title{Create Session-Scoped \verb{MCP} State Environment}
\usage{
mcptool_state_factory(initialize = NULL, force_init = FALSE, .state = NULL)
}
\arguments{
\item{initialize}{Optional function to initialize the session state.
Should accept the environment as its first argument and perform any
required setup}

\item{force_init}{Logical. If \code{TRUE}, runs the \code{initialize} function even
if the environment appears already initialized. Default is \code{FALSE}.}

\item{.state}{Optional existing environment to use. If provided, it will be
validated and potentially initialized. If \code{NULL}, creates a new environment}
}
\value{
An environment of class \code{"tricobbler_mcp_session_state"} with
methods available for key-value storage:
\describe{
\item{\code{reset()}}{Remove all objects from the map}
\item{\code{set(key, value)}}{Set a key-value pair. Returns the value}
\item{\code{get(key, missing = NULL)}}{Get a value by key. Returns \code{missing}
if key not found}
\item{\code{mget(keys, missing = NULL)}}{Get multiple values by keys}
\item{\code{has(key)}}{Check if a key exists. Returns \code{TRUE} or \code{FALSE}}
\item{\code{remove(key)}}{Remove a key-value pair}
\item{\code{keys(sort = FALSE)}}{Get all keys}
\item{\code{size()}}{Get the number of items in the map}
\item{\code{clone()}}{Return a shallow copy of the map}
\item{\code{as_list(sort = FALSE)}}{Return a named list of all key-value pairs}
}
and internal variables:
\describe{
\item{\code{.initialized}}{Logical flag indicating initialization status}
\item{\code{.stores}}{The underlying object that persists the key-values}
}
Parent environment contains read-only shared variables:
\describe{
\item{\code{.platform}}{Platform information from \code{.Platform}}
\item{\code{.interactive}}{Whether session is interactive}
\item{\code{.session_info}}{Session information from \code{sessionInfo()}}
}
}
\description{
Factory function that creates isolated state environments for \verb{MCP} tool
sessions. Each session maintains independent pipeline context, eliminating
cross-contamination between concurrent chats or users.
}
\examples{
# Create a fresh session state
state1 <- mcptool_state_factory()
state1$set("current_pipeline", "my_pipeline")
state1$.initialized  # TRUE

# Create with initialization
init_fn <- function(env) {
  env$set("work_path", getwd())
}
state2 <- mcptool_state_factory(initialize = init_fn)
state2$get("work_path")

# Reuse existing environment
state3 <- mcptool_state_factory(.state = state1)
identical(state1, state3)  # TRUE

# Access shared read-only parent variables
get(".platform", state1)
get(".session_info", state1)

}

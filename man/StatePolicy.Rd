% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class001-policy.R
\name{StatePolicy}
\alias{StatePolicy}
\title{State-Level Policy Implementation for Workflow Stages}
\usage{
StatePolicy(
  name = character(0),
  description = character(0),
  stage = character(0),
  parameters = list(),
  priority = 100L,
  critical = FALSE
)
}
\arguments{
\item{name}{Character. Name of the state policy (non-blank).}

\item{description}{Character. Human-readable description.}

\item{stage}{Character. Must be a non-blank single string.}

\item{parameters}{List. Optional state-specific parameters.}

\item{priority}{Integer. Execution priority (0-999, default 100). Higher values
run first (999 = highest priority, 0 = lowest). Used when multiple states
share the same stage. NA or NULL are treated as 100.}

\item{critical}{Logical. If \code{TRUE}, states with lower priority won't
execute if this state fails (default \code{FALSE}). Critical states must have
\code{priority >= 1} and cannot share priority code with other states.}
}
\description{
Represents a single workflow state. Inherits from \code{BasePolicy}
and adds a mandatory \code{stage} that must match one of the stages defined in a
\code{MasterPolicy}. Includes priority and criticality flags for execution ordering
when multiple states share the same stage.
}
\details{
\subsection{Stages vs States}{
\itemize{
\item \strong{Stage} (macro): The workflow phase name from \code{MasterPolicy@stages} (e.g., "executing")
\item \strong{State} (micro): A concrete \code{StatePolicy} implementation of that stage
\item Multiple states can reference the same stage for different execution patterns
}
}

\subsection{Priority System and Execution Patterns}{

When multiple states share the same stage, execution pattern depends on priority:
\itemize{
\item \strong{Range}: 0 (lowest) to 999 (highest)
\item \strong{Default}: 100 (when \code{priority = NA} or \code{NULL})
\item \strong{Equal priority}: States run in parallel (truly concurrent execution)
\item \strong{Different priorities}: States run sequentially (higher priority first)
}
}

\subsection{Critical Flag: Enforcing Sequential Execution}{

The \code{critical} flag enforces \strong{sequential} execution with fail-fast semantics:
\itemize{
\item If \code{critical = TRUE}, this state \strong{must} execute and succeed before any
lower-priority states in the same stage can run
\item If a critical state fails, lower-priority states are skipped entirely
\item Critical states \strong{prevent parallel execution} - you cannot have parallel
states when one is marked critical (enforced by priority uniqueness)
\item Critical states must have \code{priority >= 1} (cannot be lowest priority 0)
\item Critical states cannot share their priority value with other states in the
same stage (enforced by \code{Manifest} validator)
\item \strong{Use case}: Required validation gates that must pass before alternatives run
}
}

\subsection{When to Use Multiple States Per Stage}{

Create multiple \code{StatePolicy} objects for the same stage when you need:
\enumerate{
\item \strong{Parallel alternatives}: Multiple states with equal priority for concurrent
execution (e.g., A/B testing, redundant processing)
\item \strong{Sequential fallback chains}: Different priorities create ordered execution
with fallbacks (e.g., primary approach → fallback → last resort)
\item \strong{Critical validation gates}: Critical state must succeed before lower-priority
alternatives execute (enforces sequential, fail-fast semantics)
\item \strong{Staged rollout}: Gradually shift priority as new implementations mature
}
}
}
\examples{

# Basic state
StatePolicy(
  name = "state1",
  stage = "idle",
  description = "initial idle state",
  parameters = list()
)

# Critical high-priority state
StatePolicy(
  name = "validator",
  stage = "executing",
  description = "critical validation step",
  priority = 900,
  critical = TRUE
)

}

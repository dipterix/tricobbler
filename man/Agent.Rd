% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class-baseagent.R
\name{Agent}
\alias{Agent}
\title{Agent Function Wrapper for State Execution}
\usage{
Agent(
  .data = function() NULL,
  id = character(0),
  description = character(0),
  describe = tricobbler::mcp_describe
)
}
\arguments{
\item{.data}{function, the agent implementation with signature
\code{function(runtime, ...)}}

\item{id}{character, unique identifier for the agent (letters, digits,
underscores, dashes only)}

\item{description}{character, human-readable description of what the
agent does}

\item{describe}{function or \code{NULL}, result formatting function for
logging; defaults to \code{\link{mcp_describe}}. If provided, should
accept the agent's return value as its first argument and return a
character string}
}
\value{
An \code{Agent} object (S7 class inheriting from
\code{\link{function}})
}
\description{
Creates an executable agent that can be registered with a
\code{\link{Scheduler}} to execute state-specific logic. The agent wraps
a user-defined function with metadata (\code{id}, \code{description}) and
result formatting. Agents are the execution units in the Runtime Layer
(Tier 2) that implement the logic defined in
\code{\link{StatePolicy}} objects from the Policy Layer (Tier 1).
}
\details{
\subsection{Agent Function Signature}{

The wrapped function must have the following signature:
\preformatted{
function(runtime, ...) {
  # Agent implementation
  # runtime$agent - the Agent object itself
  # runtime$policy - the StatePolicy being executed
  # runtime$context - the AgentContext for logging
  # runtime$logger() - shorthand for logging
  # Return value will be logged to context via @describe
}
}

\strong{Required arguments:}
\itemize{
\item \code{runtime}: An \code{\link{AgentRuntime}} object containing:
\itemize{
\item \code{runtime$agent}: Reference to the \code{Agent} object
itself
\item \code{runtime$policy}: The \code{\link{StatePolicy}} object
being executed
\item \code{runtime$context}: The \code{\link{AgentContext}} object
for logging and storage
\item \code{runtime$logger()}: Method to log messages
}
\item \code{...}: Additional arguments (optional)
}
}

\subsection{Agent Execution Flow}{

When a \code{\link{Scheduler}} executes a state:
\enumerate{
\item Looks up the agent by \code{StatePolicy@agent_id}
\item Creates an \code{\link{AgentRuntime}} with agent, policy, and
context
\item Calls the agent function with \code{(runtime)}
\item Captures the return value
\item Uses the \code{describe} function to format the result for logging
\item Logs formatted result to \code{\link{AgentContext}}
}
}

\subsection{Result Description}{

The \code{describe} property controls how results are formatted for
AI-readable logs. By default, uses \code{\link{mcp_describe}} which
captures the printed results. The \code{describe} property serves
three purposes: first, the function allows the agent to format the
output for better AI-readability. The formatted results will be logged
into a public log file along with the scheduling messages;
second, the agent can choose to redact sensitive information and avoid
insecure agents from accessing those data - reading attachments
requires permissions and those agents (according to how they are
implemented) should not access the attachments; finally, because the
output description will be recorded into the public log file so the other
agents can still refer to the context without reading the corresponding
attachment file. For example, if a local agent's output contains
user-sensitive data, its \code{describe} function may hide those
information by string replacement, or simply show the data format and
schema. Other online agents may still see the redacted outputs from the
log files and work on the output (such as writing code or executing
the tools).
}
}
\examples{


# Basic agent
simple_agent <- Agent(
  function(runtime) {
    runtime$logger("Executing simple task")
    return("Task completed")
  },
  id = "simple_agent",
  description = "A simple demonstration agent"
)


# Agent with custom result formatting function
analysis_agent <- Agent(
  function(runtime) {
    result <- list(
      status = "success",
      items_processed = 42,
      timestamp = Sys.time(),
      long_result = rnorm(100),
      sensitive_data = "my password"
    )
    return(result)
  },
  id = "analysis_agent",
  description = "Performs data analysis",
  describe = function(result) {
    result$sensitive_data <- "<password redacted...>"
    c(
      sprintf("Processed \%d items at \%s.\n",
              result$items_processed, result$timestamp),
      "Here are the snapshots with R str():",
      utils::capture.output(str(result))
    )
  }
)

# run these agents
manifest <- Manifest(
  master = MasterPolicy(
    name = "example",
    version = "0.0.1",
    stages = "executing"
  ),
  states = list(
    StatePolicy(name = "simply_policy",
                stage = "executing",
                agent_id = "simple_agent"),
    StatePolicy(name = "analysis_policy",
                stage = "executing",
                agent_id = "analysis_agent")
  )
)

scheduler <- Scheduler$new(manifest = manifest,
                           agents = list(simple_agent, analysis_agent))

if(interactive()) {
  scheduler$start()
  # TRACE 10:53:15 [scheduler]: Initializing resources
  # TRACE 10:53:15 [scheduler]: current stage: executing
  # TRACE 10:53:15 [scheduler]: starting state: simply_policy with
  #  agent simple_agent (attempt 0)
  # INFO 10:53:15 [Agent simple_agent]: Executing simple task
  # INFO 10:53:15 [context]: Following result recorded:
  #  Agent=simple_agent, stage=executing,
  #  state=simply_policy, attempt=0,
  #  identifier=[executing][simply_policy][simple_agent]_20T105315_0
  # INFO 10:53:15 [context]: "Task completed"
  # TRACE 10:53:15 [scheduler]: starting state: analysis_policy with
  #  agent analysis_agent (attempt 0)
  # INFO 10:53:15 [context]: Following result recorded:
  #  Agent=analysis_agent, stage=executing,
  #  state=analysis_policy, attempt=0,
  #  identifier=[executing][analysis_policy][analysis_agent]_20T105315_0
  # INFO 10:53:15 [context]: Processed 42 items at 10:53:15.
  # INFO 10:53:15 [context]: Here are the snapshots with R str():
  #  List of 5 $ status :
  #    chr "success" $ items_processed: num 42
  #    $ timestamp : POSIXct[1:1], format: "2026-02-03 10:53:15"
  #    $ long_result : num [1:100] 0.372 0.504 -1.584 -0.728 0.18 ...
  #    $ sensitive_data : chr "<password redacted...>"
  # TRACE 10:53:15 [scheduler]: current stage: ready
}


}

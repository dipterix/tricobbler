<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Agent Function Wrapper for State Execution — Agent • tricobbler</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Agent Function Wrapper for State Execution — Agent"><meta name="description" content="Creates an executable agent that can be registered with a
Scheduler to execute state-specific logic. The agent wraps
a user-defined function with metadata (id, description) and
result formatting. Agents are the execution units in the Runtime Layer
(Tier 2) that implement the logic defined in
StatePolicy objects from the Policy Layer (Tier 1)."><meta property="og:description" content="Creates an executable agent that can be registered with a
Scheduler to execute state-specific logic. The agent wraps
a user-defined function with metadata (id, description) and
result formatting. Agents are the execution units in the Runtime Layer
(Tier 2) that implement the logic defined in
StatePolicy objects from the Policy Layer (Tier 1)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tricobbler</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Agent Function Wrapper for State Execution</h1>

      <div class="d-none name"><code>Agent.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates an executable agent that can be registered with a
<code><a href="Scheduler.html">Scheduler</a></code> to execute state-specific logic. The agent wraps
a user-defined function with metadata (<code>id</code>, <code>description</code>) and
result formatting. Agents are the execution units in the Runtime Layer
(Tier 2) that implement the logic defined in
<code><a href="StatePolicy.html">StatePolicy</a></code> objects from the Policy Layer (Tier 1).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Agent</span><span class="op">(</span></span>
<span>  .data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="cn">NULL</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  describe <span class="op">=</span> <span class="fu">tricobbler</span><span class="fu">::</span><span class="va"><a href="mcp_describe.html">mcp_describe</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>function, the agent implementation with signature
<code>function(runtime, ...)</code></p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>character, unique identifier for the agent (letters, digits,
underscores, dashes only)</p></dd>


<dt id="arg-description">description<a class="anchor" aria-label="anchor" href="#arg-description"></a></dt>
<dd><p>character, human-readable description of what the
agent does</p></dd>


<dt id="arg-describe">describe<a class="anchor" aria-label="anchor" href="#arg-describe"></a></dt>
<dd><p>function or <code>NULL</code>, result formatting function for
logging; defaults to <code><a href="mcp_describe.html">mcp_describe</a></code>. If provided, should
accept the agent's return value as its first argument and return a
character string</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>Agent</code> object (S7 class inheriting from
<code><a href="https://rdrr.io/r/base/function.html" class="external-link">function</a></code>)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="agent-function-signature">Agent Function Signature<a class="anchor" aria-label="anchor" href="#agent-function-signature"></a></h3>


<p>The wrapped function must have the following signature:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">runtime</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Agent implementation</span></span>
<span>  <span class="co"># runtime$agent - the Agent object itself</span></span>
<span>  <span class="co"># runtime$policy - the StatePolicy being executed</span></span>
<span>  <span class="co"># runtime$context - the AgentContext for logging</span></span>
<span>  <span class="co"># runtime$logger() - shorthand for logging</span></span>
<span>  <span class="co"># Return value will be logged to context via @describe</span></span>
<span><span class="op">}</span></span></code></pre></div>

<p><strong>Required arguments:</strong></p><ul><li><p><code>runtime</code>: An <code><a href="AgentRuntime.html">AgentRuntime</a></code> object containing:</p><ul><li><p><code>runtime$agent</code>: Reference to the <code>Agent</code> object
itself</p></li>
<li><p><code>runtime$policy</code>: The <code><a href="StatePolicy.html">StatePolicy</a></code> object
being executed</p></li>
<li><p><code>runtime$context</code>: The <code><a href="AgentContext.html">AgentContext</a></code> object
for logging and storage</p></li>
<li><p><code>runtime$logger()</code>: Method to log messages</p></li>
</ul></li>
<li><p><code>...</code>: Additional arguments (optional)</p></li>
</ul></div>

<div class="section">
<h3 id="agent-execution-flow">Agent Execution Flow<a class="anchor" aria-label="anchor" href="#agent-execution-flow"></a></h3>


<p>When a <code><a href="Scheduler.html">Scheduler</a></code> executes a state:</p><ol><li><p>Looks up the agent by <code>StatePolicy@agent_id</code></p></li>
<li><p>Creates an <code><a href="AgentRuntime.html">AgentRuntime</a></code> with agent, policy, and
context</p></li>
<li><p>Calls the agent function with <code>(runtime)</code></p></li>
<li><p>Captures the return value</p></li>
<li><p>Uses the <code>describe</code> function to format the result for logging</p></li>
<li><p>Logs formatted result to <code><a href="AgentContext.html">AgentContext</a></code></p></li>
</ol></div>

<div class="section">
<h3 id="result-description">Result Description<a class="anchor" aria-label="anchor" href="#result-description"></a></h3>


<p>The <code>describe</code> property controls how results are formatted for
AI-readable logs. By default, uses <code><a href="mcp_describe.html">mcp_describe</a></code> which
captures the printed results. The <code>describe</code> property serves
three purposes: first, the function allows the agent to format the
output for better AI-readability. The formatted results will be logged
into a public log file along with the scheduling messages;
second, the agent can choose to redact sensitive information and avoid
insecure agents from accessing those data - reading attachments
requires permissions and those agents (according to how they are
implemented) should not access the attachments; finally, because the
output description will be recorded into the public log file so the other
agents can still refer to the context without reading the corresponding
attachment file. For example, if a local agent's output contains
user-sensitive data, its <code>describe</code> function may hide those
information by string replacement, or simply show the data format and
schema. Other online agents may still see the redacted outputs from the
log files and work on the output (such as writing code or executing
the tools).</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic agent</span></span></span>
<span class="r-in"><span><span class="va">simple_agent</span> <span class="op">&lt;-</span> <span class="fu">Agent</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">runtime</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">runtime</span><span class="op">$</span><span class="fu">logger</span><span class="op">(</span><span class="st">"Executing simple task"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"Task completed"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="st">"simple_agent"</span>,</span></span>
<span class="r-in"><span>  description <span class="op">=</span> <span class="st">"A simple demonstration agent"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Agent with custom result formatting function</span></span></span>
<span class="r-in"><span><span class="va">analysis_agent</span> <span class="op">&lt;-</span> <span class="fu">Agent</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">runtime</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      status <span class="op">=</span> <span class="st">"success"</span>,</span></span>
<span class="r-in"><span>      items_processed <span class="op">=</span> <span class="fl">42</span>,</span></span>
<span class="r-in"><span>      timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      long_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      sensitive_data <span class="op">=</span> <span class="st">"my password"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="st">"analysis_agent"</span>,</span></span>
<span class="r-in"><span>  description <span class="op">=</span> <span class="st">"Performs data analysis"</span>,</span></span>
<span class="r-in"><span>  describe <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">result</span><span class="op">$</span><span class="va">sensitive_data</span> <span class="op">&lt;-</span> <span class="st">"&lt;password redacted...&gt;"</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Processed %d items at %s.\n"</span>,</span></span>
<span class="r-in"><span>              <span class="va">result</span><span class="op">$</span><span class="va">items_processed</span>, <span class="va">result</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="st">"Here are the snapshots with R str():"</span>,</span></span>
<span class="r-in"><span>      <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run these agents</span></span></span>
<span class="r-in"><span><span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="Manifest.html">Manifest</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  master <span class="op">=</span> <span class="fu"><a href="MasterPolicy.html">MasterPolicy</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"example"</span>,</span></span>
<span class="r-in"><span>    version <span class="op">=</span> <span class="st">"0.0.1"</span>,</span></span>
<span class="r-in"><span>    stages <span class="op">=</span> <span class="st">"executing"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="StatePolicy.html">StatePolicy</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"simply_policy"</span>,</span></span>
<span class="r-in"><span>                stage <span class="op">=</span> <span class="st">"executing"</span>,</span></span>
<span class="r-in"><span>                agent_id <span class="op">=</span> <span class="st">"simple_agent"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="StatePolicy.html">StatePolicy</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"analysis_policy"</span>,</span></span>
<span class="r-in"><span>                stage <span class="op">=</span> <span class="st">"executing"</span>,</span></span>
<span class="r-in"><span>                agent_id <span class="op">=</span> <span class="st">"analysis_agent"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">scheduler</span> <span class="op">&lt;-</span> <span class="va"><a href="Scheduler.html">Scheduler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>manifest <span class="op">=</span> <span class="va">manifest</span>,</span></span>
<span class="r-in"><span>                           agents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">simple_agent</span>, <span class="va">analysis_agent</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">scheduler</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># TRACE 10:53:15 [scheduler]: Initializing resources</span></span></span>
<span class="r-in"><span>  <span class="co"># TRACE 10:53:15 [scheduler]: current stage: executing</span></span></span>
<span class="r-in"><span>  <span class="co"># TRACE 10:53:15 [scheduler]: starting state: simply_policy with</span></span></span>
<span class="r-in"><span>  <span class="co">#  agent simple_agent (attempt 0)</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [Agent simple_agent]: Executing simple task</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [context]: Following result recorded:</span></span></span>
<span class="r-in"><span>  <span class="co">#  Agent=simple_agent, stage=executing,</span></span></span>
<span class="r-in"><span>  <span class="co">#  state=simply_policy, attempt=0,</span></span></span>
<span class="r-in"><span>  <span class="co">#  identifier=[executing][simply_policy][simple_agent]_20T105315_0</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [context]: "Task completed"</span></span></span>
<span class="r-in"><span>  <span class="co"># TRACE 10:53:15 [scheduler]: starting state: analysis_policy with</span></span></span>
<span class="r-in"><span>  <span class="co">#  agent analysis_agent (attempt 0)</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [context]: Following result recorded:</span></span></span>
<span class="r-in"><span>  <span class="co">#  Agent=analysis_agent, stage=executing,</span></span></span>
<span class="r-in"><span>  <span class="co">#  state=analysis_policy, attempt=0,</span></span></span>
<span class="r-in"><span>  <span class="co">#  identifier=[executing][analysis_policy][analysis_agent]_20T105315_0</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [context]: Processed 42 items at 10:53:15.</span></span></span>
<span class="r-in"><span>  <span class="co"># INFO 10:53:15 [context]: Here are the snapshots with R str():</span></span></span>
<span class="r-in"><span>  <span class="co">#  List of 5 $ status :</span></span></span>
<span class="r-in"><span>  <span class="co">#    chr "success" $ items_processed: num 42</span></span></span>
<span class="r-in"><span>  <span class="co">#    $ timestamp : POSIXct[1:1], format: "2026-02-03 10:53:15"</span></span></span>
<span class="r-in"><span>  <span class="co">#    $ long_result : num [1:100] 0.372 0.504 -1.584 -0.728 0.18 ...</span></span></span>
<span class="r-in"><span>  <span class="co">#    $ sensitive_data : chr "&lt;password redacted...&gt;"</span></span></span>
<span class="r-in"><span>  <span class="co"># TRACE 10:53:15 [scheduler]: current stage: ready</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dipterix Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>


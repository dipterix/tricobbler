[{"path":"http://dipterix.org/tricobbler/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2026 tricobbler authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR description NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":null,"dir":"","previous_headings":"","what":"TriCobbler Async Architecture TODO","title":"TriCobbler Async Architecture TODO","text":"document outlines implementation plan async/parallel execution support tricobbler.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"TriCobbler Async Architecture TODO","text":"Goal: Enable concurrent agent execution using R promises, allowing multiple LLM calls run simultaneously without blocking. agent return promise object Architecture Decision: Use coro + promises (future) : - LLM agents /O-bound (waiting API responses), CPU-bound - Single-process async avoids serialization overhead multi-process approaches - ellmer::Chat supports chat$chat_async(), chat$stream_async(), chat$chat_structured_async() returning promises - chat$clone() supported parallel Chat agent isolation - Simpler thread-safety model (single event loop vs file locking)","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"phase-1-foundation---explicit-dependencies-done","dir":"","previous_headings":"","what":"Phase 1: Foundation - Explicit Dependencies [Done]","title":"TriCobbler Async Architecture TODO","text":": Current last_results(1) returns chronologically last result. parallel execution, result order non-deterministic. Agents must explicitly declare states depend .","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_11-add-depends_on-property-to-statepolicy","dir":"","previous_headings":"Phase 1: Foundation - Explicit Dependencies [Done]","what":"1.1 Add depends_on Property to StatePolicy","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-policy.R Steps: 1. Add new S7 property StatePolicy: r    depends_on = S7::new_property(      class = StateDeps,  # Implemented separate S7 class      default = StateDeps()    ) 2. dependency entry named list element (key = parameter name): - state: Name state depends (character) - field: extract - \"result\" \"description\" (character) - stage: (Optional) Stage name depending earlier stage 3. Add validator StateDeps ensure entries required fields (format) 4. Add validator property states Manifest ensure dependency entries valid (logic) 5. Update manifest_write() manifest_read() serialization Example manifest:","code":"states:   - name: aggregator     stage: executing     priority: 50     agent_id: aggregator_agent     accessibility: explicit     depends_on:       validation_result:         state: validator         field: result       parsed_data:         state: parser         field: result"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_12-add-accessibility--explicit-level","dir":"","previous_headings":"Phase 1: Foundation - Explicit Dependencies [Done]","what":"1.2 Add accessibility = \"explicit\" Level","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-policy.R, R/class-baseagent.R Steps: 1. Update accessibility property validator accept \"explicit\" value 2. Modify as_agent() wrapper handle \"explicit\" accessibility: - Build inputs depends_on mapping instead last_results() (deterministic agents functions MCP tools) - AI agents, include depends_on chat context (user prompts, see item 3) - Use new get_attachment_by_state() method (see 1.3) 3. Keep \"\", \"logs\", \"none\" working: - “none”: agent access logs attachment; situation, depends_on indicates agent await dependents finish, access contents - “logs”: agent access logs attachment list contents; situation, depends_on indicates agent await dependents finish, access contents - “explicit”: agent access logs, attachment list, attachments depends_on list. MCP tool read attachments provided. However, depends_on descriptions included user prompt - “”: agent provided tools access logs attachments, user prompt also includes depends_on descriptions","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_13-add-get_attachment_by_state-to-context","dir":"","previous_headings":"Phase 1: Foundation - Explicit Dependencies [Done]","what":"1.3 Add get_attachment_by_state() to Context","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-context.R Steps: 1. Add new public method: r    get_attachment_by_state = function(state, stage) {      # Find attachment matching state stage      # Return recent match multiple exist (retries)    } 2. Use private$.results index locate attachment state name 3. Load return attachment object","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"phase-2-globals-isolation-done","dir":"","previous_headings":"","what":"Phase 2: Globals Isolation [Done]","title":"TriCobbler Async Architecture TODO","text":": Current globals (active_context, active_agent, active_policy) R/aaa.R shared across agents. parallel execution, concurrent agents overwrite ’s globals, causing MCP tools receive wrong context.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_21-create-agentruntime-class","dir":"","previous_headings":"Phase 2: Globals Isolation [Done]","what":"2.1 Create AgentRuntime Class","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-runtime.R Implementation: 1. Created AgentRuntime R6 class per-execution state: r    AgentRuntime <- R6::R6Class(      private = list(        .agent = NULL,        # Current Agent ()        .context = NULL,      # AgentContext ()        .policy = NULL,       # StatePolicy ()        .execution_id = NULL  # Unique ID execution      ),      active = list(        agent = function() { private$.agent },        context = function() { private$.context },        policy = function() { private$.policy },        execution_id = function() { private$.execution_id }      ),      public = list(        logger = function(...) { ... },  # Convenience method        run = function(attempt) { ... },       # Sync execution        run_async = function(attempt) { ... }  # Async execution      )    ) 2. Runtime instantiated per-execution Scheduler passed agents 3. Encapsulates execution logic run() run_async() methods using coro::async/await","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_22-update-mcp-tools-for-explicit-runtime","dir":"","previous_headings":"Phase 2: Globals Isolation [Done]","what":"2.2 Update MCP Tools for Explicit Runtime","title":"TriCobbler Async Architecture TODO","text":"Location: R/mcp-tooldef-config.R, R/mcp-tooldef-context.R, R/mcp-tools.R Implementation: 1. Added .runtime parameter MCP tools: r    mcp_tool_context_logs_tail <- function(max_lines, skip_lines, .runtime = NULL) {      ctx <- (!.null(.runtime)) .runtime$context else NULL      # ...    } 2. mcptool_instantiate() detects .runtime parameter via formals() inspection 3. Runtime injected via closure capture tool instantiation time: r    mcptool_instantiate <- function(tool, ..., runtime = NULL) {      has_runtime_param <- \".runtime\" %% names(formals(impl))      wrapper_fun <- function() {        (has_runtime_param && !.null(runtime)) {          call[[\".runtime\"]] <- runtime        }        # ...      }    } 4. Removed globals infrastructure (set_globals, get_globals, get_active_context)","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_23-update-agent-function-signature","dir":"","previous_headings":"Phase 2: Globals Isolation [Done]","what":"2.3 Update Agent Function Signature","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-baseagent.R Implementation: 1. Agent functions now require runtime first parameter: r    function(runtime, ...) {      # runtime$agent - Agent object      # runtime$policy - StatePolicy executed      # runtime$context - Context logging      # runtime$logger() - shorthand logging    } 2. Validator enforces runtime first argument name 3. Scheduler creates runtime calls runtime$run(), records results via .call()","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"phase-3-per-runtime-logging--atomic-attachments-done","dir":"","previous_headings":"","what":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","title":"TriCobbler Async Architecture TODO","text":": AgentRuntime owns execution lifecycle completely—one runtime = one attempt = one attachment. Per-runtime log files enable crash inspection clean separation concerns without file locking (unnecessary since R promises/coro single-threaded). Key insight: One AgentRuntime = one execution attempt = one attachment. attachment_id (format [stage][state][agent_id]_YYMMDDTHHMMSS_{attempt}) primary key across log files, .rds attachments, SQLite index.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_31-move-attempt-to-agentruntime-initializer-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.1 Move attempt to AgentRuntime Initializer [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-runtime.R Implementation: 1. AgentRuntime$new(agent, context, policy, attempt = 0L) — attempt validated stored construction 2. attachment_id generated immediately constructor: r    private$.attachment_id <- sprintf(      \"[%s][%s][%s]_%s_%d\",      policy@stage, policy@name, agent@id,      format(now, \"%y%m%dT%H%M%S\"), attempt    ) 3. Runtime registers AttachmentIndex status \"init\" construction 4. run() run_async() take arguments — attempt already known 5. Scheduler creates fresh AgentRuntime per retry attempt, passing cumulative retry count","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_32-per-runtime-log-file-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.2 Per-Runtime Log File [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-runtime.R Implementation: 1. $logger(...) writes {attachment_path}/{attachment_id}.log via log_to_file(), optionally mirrors main context log running main process (Sys.getpid() check) 2. $logger() supports level, verbose, public, role parameters — reuses shared log_to_file() helper R/helper-logger.R 3. separate $get_logs() runtime — context provides $get_runtime_log(attachment_id) instead","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_33-timing-capture--result-recording-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.3 Timing Capture & Result Recording [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-runtime.R Implementation: 1. private$.create_run_impl() captures time_started <- Sys.time() execution start passes started duration .record_result() 2. private$.record_result(result, succeed, ...) handles result finalization: - Calls agent@describe(result) human-readable description - Saves .rds attachment {attachment_path}/{attachment_id}.rds - Logs result summary: Status=finished Status=errored - Calls context$record_attachment(runtime, succeed) update index 3. Index status transitions: init → running (execution start) → finished/errored (result recording)","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_34-sqlite-backed-attachmentindex-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.4 SQLite-Backed AttachmentIndex [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-attachment-index.R (new file) Implementation: AttachmentIndex R6 class backed RSQLite, replacing previous text-based .results data.frame AgentContext. Schema: Indexes (state, stage) (status) common queries. Connection lifecycle: Open/close per operation via private$.with_db(callback) — negligible overhead ~3-15 writes per scheduler run, safe connection leaks. Backend abstraction: SQLite calls isolated $.with_db() $.init_db(). swap duckdb another backend, two private methods need modification. Public API: $register(attachment_id, stage, state, agent_id, attempt) — INSERT REPLACE status \"init\" $update_status(attachment_id, status) — set status init/running/finished/errored/skipped $mark_finished(attachment_id, succeed) — convenience: sets status + succeed flag $get(attachment_id) — single-row lookup $list(status = NULL) — entries, recent first, optional status filter $query(state, stage, status) — filter state/stage/status $list_incomplete(timeout_secs = NULL) — entries status init running, optionally past timeout $exists(attachment_id) — fast existence check $get_db_path() — returns SQLite file path Status lifecycle: init → running → finished | errored (skipped reserved future use)","code":"CREATE TABLE attachment_index (   attachment_id TEXT PRIMARY KEY,   stage         TEXT NOT NULL,   state         TEXT NOT NULL,   agent_id      TEXT NOT NULL,   attempt       INTEGER NOT NULL DEFAULT 0,   status        TEXT NOT NULL DEFAULT 'init',   succeed       INTEGER,   created_at    REAL NOT NULL,   updated_at    REAL NOT NULL )"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_35-simplified-agentcontext-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.5 Simplified AgentContext [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-context.R Implementation: 1. private$.results (data.frame) replaced private$.index (AttachmentIndex) 2. init_resources() creates AttachmentIndex$new(db_path) {attachment_path}/index.sqlite 3. $index active binding exposes index (read-) 4. record_attachment(runtime, succeed) delegates index$mark_finished() — logs status=finished status=errored 5. last_results(), get_attachment(), get_attachment_by_state(), list_attachments() query index 6. New $list_incomplete(timeout_secs) — delegates index$list_incomplete() 7. New $get_runtime_log(attachment_id) — reads {attachment_path}/{attachment_id}.log","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_36-scheduler-integration-done","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.6 Scheduler Integration [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Implementation: 1. Creates fresh AgentRuntime$new(agent, context, policy, attempt = init_retry_count) per attempt 2. Calls runtime$run() internally handles full lifecycle (init → running → record result → update index) 3. Retry logic remains scheduler (retry_map tracks cumulative failure count per state) 4. Fixed bare context → self$context reference bug","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_37-bug-fixes-applied","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"3.7 Bug Fixes Applied","title":"TriCobbler Async Architecture TODO","text":"Column name mismatch: init_resources() used attachment_id record_attachment() used filename — fixed SQLite schema column names defined MCP fallback mismatch: Empty fallback data.frame used current_attempt actual data used attempt — fixed consistent schema Test references: $filename references tests updated $attachment_id RSQLite added DESCRIPTION Imports, @importFrom RSQLite SQLite added namespace","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"dependencies-added","dir":"","previous_headings":"Phase 3: Per-Runtime Logging & Atomic Attachments [Done]","what":"Dependencies Added","title":"TriCobbler Async Architecture TODO","text":"RSQLite (>= 2.3.0) DESCRIPTION Imports R/class-attachment-index.R added Collate (class-context.R)","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"phase-4-async-scheduler-done","dir":"","previous_headings":"","what":"Phase 4: Async Scheduler [Done]","title":"TriCobbler Async Architecture TODO","text":": Enable concurrent execution independent states. agent-level async primitives already place (AgentRuntime$run_async, chat_async/chat_structured_async dispatch, StateDeps, AttachmentIndex). phase adds scheduler orchestration layer. Architecture: Queue + Waiting Pool (replaces original rigid priority-group model). States enter ready-queue depends_on satisfied, get dispatched bounded waiting pool, scheduler drains pool promises resolve — feeding newly-unblocked states queue without waiting entire priority tier finish. Key insight: R’s coro/promises async single-threaded cooperative multitasking, true parallelism. R code runs one thread; concurrency happens /O waits (e.g., waiting LLM API responses). means: - race conditions R-side data structures (mutexes needed) - SQLite open/close-per-operation safe without WAL mode - event loop yields control await points - chat$clone(deep = TRUE) still needed multiple agents sharing Chat corrupt conversation state interleaved await boundaries","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_41-direct-function-call-lifecycle-event-system-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.1 Direct Function-Call Lifecycle Event System [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-event-dispatcher.R, R/helper-conditions.R : scheduler needs communicate lifecycle events (suspend, state completed, stage completed, dispatch) callers. Rather requiring users wrap scheduler$start() withCallingHandlers(), Scheduler owns internal EventDispatcher manages listener registry. Users call scheduler$(\"suspend\", handler) register listeners. Design decision: original plan specified condition-based approach (signalCondition/withCallingHandlers/withRestarts/$wrap()). abandoned coro::async support withCallingHandlers() inside coroutine bodies — conditions raised await point escape handler frame. Instead, dispatcher uses direct function-call dispatch: $emit(event) iterates snapshot handler list calls handler(event) directly. compatible coro::async avoids coroutine limitation entirely. Architecture: - EventDispatcher (internal R6 class) owns per-type ordered handler list provides $(), $(), $emit(), $(), $clear() methods - Scheduler composes EventDispatcher instance (-, -) delegates $() / $() public methods - $emit(event) returns first non-NULL handler return value (first-wins semantics) — used suspend capture chosen action string listener - $wrap() method — conditions, restarts, withCallingHandlers/withRestarts Implementation: Event constructors R/helper-conditions.R: tricobbler_event(type, message, ...) — creates plain list class = c(\"tricobbler_<type>\", \"tricobbler_lifecycle\") fields spread flat. R conditions; plain list event objects passed $emit(). Lifecycle event types (emitted Scheduler via dispatch_event()): EventDispatcher R6 class R/class-event-dispatcher.R: Uses fastmap::fastmap() top-level type registry reverse-lookup map Per-type handlers stored plain list guarantee deterministic execution order digest::digest(list(handler, type)) auto-generates deterministic IDs, preventing duplicate registration User-supplied id enables explicit replacement (upsert semantics) $(type, handler, id, ) — = TRUE appends (default), = FALSE prepends $(id, types) — removes ID; reverse-lookup avoids needing type $(type, id) — checks whether listener registered $clear(type) — clears one types; also called finalize() Composed Scheduler: direct-call condition-based: - Compatible coro::async (conditions preserved across await points) - Simpler mental model — scheduler$(\"event\", fn) return-value semantics - Registration persists across multiple start() calls - Multiple listeners event compose naturally - need understand R’s condition/restart system Dependencies: coro, promises, fastmap, digest already Imports. new dependencies needed.","code":"# Delegate listener registration scheduler$on(\"runtime.resolved\", function(event) {   cat(\"Done:\", event$state_name, \"\\n\") })  # Auto-skip on suspend (CI/tests): scheduler$on(\"suspend\", function(event) {   \"skip\"  # return value is captured as the action })  # Custom suspend logic: scheduler$on(\"suspend\", function(event) {   if (event$state_name == \"non_essential\") \"skip\" else \"abort\" })  # Replace a handler by supplying the same id: scheduler$on(\"suspend\", my_new_handler, id = \"my_suspend\")"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_42-suspend-with-error-propagation-and-action-dispatch-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.2 suspend() with Error Propagation and Action Dispatch [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Implementation: 1. Error propagation: execute_runtime()’s onFulfilled callback checks result$succeed. critical state exhausts retries, error result passed directly self$suspend(error = result$error, ...). private$.last_error set inline. 2. suspend() implementation (Scheduler$suspend(error, state_name, stage, runtime_summary)): - Sets self$suspended = TRUE - Captures context self$suspend_info (state_name, stage, error, timestamp) inspection - Logs error full traceback via utils::capture.output(traceback(error)) - Emits \"suspend\" event via self$dispatch_event() — return value (first non-NULL handler return) captured action string - listener returns action, falls interactive utils::menu() prompt \"abort\" non-interactive mode - Executes chosen action inline via switch(action, ...): - \"resume\": clears suspended state, re-adds state runtime_map attempt = 0, calls advance() - \"skip\": clears suspended state, marks state \"skipped\" completed_map, calls private$skip_dependents() transitively skip downstream dependents, calls advance() - \"restart_stage\": clears suspended state, calls self$start_stage(stage) reset per-stage structures, re-snapshots .stage_flag, calls advance() - \"abort\": clears suspended state, rejects stage promise via private$.stage_reject() 3. suspend_info field: Public field set suspension, cleared resume/skip/restart/abort. Contains state_name, stage, error, timestamp external inspection.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_43-max_concurrency-and-async-start-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.3 max_concurrency and Async start() [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Implementation: 1. max_concurrency field (integer, default 100L) — max simultaneous promises waiting pool 2. start() async — uses coro::async internally loop stages, calling await(self$run_stage(stage)) . returns promise (via impl()$(...)) resolves stages complete. 3. separate start_async() — original plan start() (sync) start_async() abandoned. start() single entry point inherently async. Callers block draining event loop (e.g., later::run_now()) await inside coro::async context. 4. Stages always executed sequentially; run_stage() runs states within stage concurrently (via queue + pool), returns promise resolves stage finishes.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_44-queue--waiting-pool-dispatch-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.4 Queue + Waiting Pool Dispatch [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Implementation: Five per-stage data structures Scheduler instance (reset start_stage()): Dispatch cycle (event-driven via advance()): Key methods: - init_stage(stage) — creates AgentRuntime state stage, populates runtime_map - enqueue_runtime() — checks depends_on resolution completed_map; moves cleared states runtime_map ready_queue sorted priority. Skips enqueuing self$draining self$suspended. - execute_runtime() — pops ready_queue max_concurrency - waiting_pool$size() slots; creates promise chain onFulfilled/onRejected callbacks; adds waiting_pool. Implements critical-state priority barrier (see 4.5). - advance() — event-driven driver; called promise callbacks. Guards cancellation (.run_flag != .stage_flag) suspension. Detects stage completion get_incomplete_size() == 0 draining empty waiting pool. - run_stage(stage) — calls start_stage(), returns promises::promise() whose resolve/reject stored private$.stage_resolve/.stage_reject settled advance(). promise_race needed: promise’s .() callback calls advance() directly, drives next dispatch cycle. simpler avoids promise_race identification problem.","code":"init_stage(stage)   └→ builds runtime_map from manifest   └→ enqueue_runtime() seeds ready_queue  run_stage(stage) returns a promise   └→ execute_runtime() kicks off first batch   └→ each promise resolution → advance()        └→ retry_runtime()    — re-creates runtimes from retry_map        └→ enqueue_runtime()  — moves dep-cleared states to ready_queue        └→ execute_runtime()  — dispatches up to max_concurrency        └→ check completion   — resolves stage promise if done"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_45-retry-on_failure-and-critical-priority-barrier-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.5 Retry, on_failure, and Critical Priority Barrier [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Retry logic (execute_runtime()’s onFulfilled callback retry_runtime()): 1. State fails, retries remain, on_failure NA: State added retry_map. retry_runtime() (called advance()) creates new AgentRuntime attempt + 1 places runtime_map. enqueue_runtime() moves ready_queue dependencies met. 2. State fails, retries remain, on_failure set: on_failure target created new AgentRuntime runtime_map (already completed -flight). failed state retried — redirect replaces retry. 3. State fails, retries exhausted, critical = TRUE: self$suspend() called error runtime summary. Suspend handler decides action (see 4.2). 4. State fails, retries exhausted, critical = FALSE: Marked \"errored\" completed_map. Downstream dependents proceed (see errored state satisfied dependency). Critical-state priority barrier (execute_runtime()): - dispatching, queued items scanned. critical = TRUE, states priority ≥ highest critical state’s priority dispatched. Lower-priority states moved back runtime_map re-evaluation critical state settles. - prevents lower-priority work starting critical state pending, since critical failure suspend entire stage. Skipped vs Errored distinction: - \"errored\": State executed failed (attachment exists error condition result) - \"skipped\": State never executed (e.g., depends skipped critical-failed state) skip_dependents() (private): state skipped (via suspend → skip action), recursively finds -stage states whose depends_on references skipped state. Marks \"skipped\" completed_map, removes runtime_map ready_queue, emits \"runtime.skipped\" events.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_46-suspend-with-direct-call-dispatch-and-interactive-fallback-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.6 Suspend with Direct-Call Dispatch and Interactive Fallback [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R suspend() works direct-call event system: suspend() called (execute_runtime()’s promise callback critical state exhausts retries): 1. Sets self$suspended = TRUE, captures suspend_info 2. Logs error full traceback 3. Calls self$dispatch_event(type = \"suspend\", ...) invokes EventDispatcher$emit() — iterates handlers returns first non-NULL return value 4. registered handler returns action string (e.g., \"skip\", \"resume\", \"abort\", \"restart_stage\"), value captured 5. handler returns action (NULL), falls : - interactive() → utils::menu() 4 choices: Retry state, Skip, Abort, Restart stage - Non-interactive → \"abort\" 6. chosen action executed inline via switch(action, ...) (see 4.2 action details) tests/CI — register listener: Key difference original plan: conditions, restarts, $wrap(). handler return value action, invokeRestart(). simpler compatible coro::async.","code":"scheduler$on(\"suspend\", function(event) {   \"skip\"  # or \"abort\", \"resume\", \"restart_stage\" }) scheduler$start()  # no wrapping needed, no blocking menu"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_47-clone-chat-for-async-isolation-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.7 Clone Chat for Async Isolation [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/generic-as_agent.R Implementation: 1. Inside agent_fun (closure created as_agent_from_chat), chat always deep-cloned top: r    chat <- chat$clone(deep = TRUE) 2. ensures execution gets Chat instance independent conversation state, system prompt, tool bindings — whether sync async. 3. clone happens unconditionally (gated runtime$status) guarantee isolation modes prevent subtle state leakage retries.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_48-final-states-drain-pool-done","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.8 final States Drain Pool [Done]","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R Implementation: 1. final = TRUE state’s promise resolves successfully, self$draining set TRUE ready_queue cleared 2. enqueue_runtime() execute_runtime() check self$draining skip work TRUE 3. advance() detects drain completion self$draining == TRUE waiting_pool$size() == 0 — clears remaining items runtime_map/ready_queue/retry_map resolves stage promise 4. -flight promises waiting pool allowed finish; results recorded normally Rationale: Promise cancellation complex error-prone. Letting -flight work complete simpler results may useful debugging.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_49-edge-cases-and-potential-bugs","dir":"","previous_headings":"Phase 4: Async Scheduler [Done]","what":"4.9 Edge Cases and Potential Bugs","title":"TriCobbler Async Architecture TODO","text":"following issues identified review. documented discussion fixing.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"bug-1-onrejected-in-execute_runtime-doesnt-clean-up-waiting-pool","dir":"","previous_headings":"Phase 4: Async Scheduler [Done] > 4.9 Edge Cases and Potential Bugs","what":"Bug 1: onRejected in execute_runtime() doesn’t clean up waiting pool","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R, execute_runtime() promise chain Issue: AgentRuntime$run_async() catches agent errors internally (onFulfilled/onRejected inner promise chain) always calls .record_result(). means outer .() execute_runtime() always receives onFulfilled. However, .record_result() throws (e.g., disk full, SQLite error, agent@describe() throws), outer onRejected fires — calls self$advance() without removing state waiting_pool recording completed_map. state effectively vanishes maps, causing stage never complete (hangs waiting item never resolve). Fix: onRejected callback : 1. Remove state waiting_pool 2. Mark \"errored\" completed_map 3. call self$advance()","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"bug-2-on_failure-target-with-unsatisfied-dependencies-can-deadlock","dir":"","previous_headings":"Phase 4: Async Scheduler [Done] > 4.9 Edge Cases and Potential Bugs","what":"Bug 2: on_failure target with unsatisfied dependencies can deadlock","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R, execute_runtime() on_failure redirect Issue: on_failure fires, target state added runtime_map fresh AgentRuntime. enqueue_runtime() checks target’s depends_on — target unmet dependencies (failed state), stay blocked runtime_map indefinitely, preventing stage completing. Note: code already TODO comment: “need check on_failure depends current runtime manifest created”. validation added Manifest validator (Phase 5). Fix options: - Add manifest validation: on_failure targets must depends_on entries unsatisfied source state fails (e.g., deps must subset source state’s deps, deps earlier stages ) - : redirect time, automatically satisfy failed state’s dependency completed_map (’s already errored) — target may deps ","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"bug-3-non-critical-exhausted-states-satisfy-downstream-dependencies-silently","dir":"","previous_headings":"Phase 4: Async Scheduler [Done] > 4.9 Edge Cases and Potential Bugs","what":"Bug 3: Non-critical exhausted states satisfy downstream dependencies silently","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R, execute_runtime() failure handling Issue: non-critical state exhausts retries, ’s marked \"errored\" completed_map. satisfies downstream depends_on checks enqueue_runtime(). Dependents enqueued execute, receiving errored state’s attachment (contains error condition result). dependent agent may expect handle error object input. Assessment: documented design (“Dependents receive error — agent function can inspect ”), ’s footgun. Function agents using accessibility = \"explicit\" receive error condition object parameter value, likely cause secondary failure. Chat agents receive textual mcp_describe() error, graceful. Potential improvements: - Add skip_dependents() call non-critical exhaustion (opt-via policy flag?) - : document clearly agents downstream non-critical states handle error inputs","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"bug-4-start-return-value-is-unclear","dir":"","previous_headings":"Phase 4: Async Scheduler [Done] > 4.9 Edge Cases and Potential Bugs","what":"Bug 4: start() return value is unclear","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-scheduler.R, start() Issue: start() uses coro::async internally calls impl()$(onFulfilled, onRejected). $() returns promise, start() doesn’t explicitly return — promise returned implicitly (last expression). @return docs say “promise resolves stages complete,” correct, $() wrapping means rejection already handled (printed message()), returned promise always resolves. Callers chain .(onRejected = ...) return value never see failures. Assessment: Minor — current pattern (print + resolve) fine interactive use. programmatic use, callers use scheduler$(\"suspend\", ...) handle failures.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"phase-5-manifest-validation-for-async","dir":"","previous_headings":"","what":"Phase 5: Manifest Validation for Async","title":"TriCobbler Async Architecture TODO","text":": Prevent invalid configurations cause undefined behavior async mode.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_51-critical-and-final-state-validation","dir":"","previous_headings":"Phase 5: Manifest Validation for Async","what":"5.1 Critical and Final State Validation","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-manifest.R (Manifest validator) Steps: 1. Validate critical = TRUE states unique priority within stage — prevents concurrent critical states fail simultaneously 2. Validate final = TRUE states unique priority within stage — prevents race two final states 3. Error manifest construction time clear message","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_52-dependency-validation-done","dir":"","previous_headings":"Phase 5: Manifest Validation for Async","what":"5.2 Dependency Validation [Done]","title":"TriCobbler Async Architecture TODO","text":"Already implemented Manifest validator: - depends_on references must exist manifest - -stage deps must strictly higher priority (guarantees execution order) - Circular dependency detection","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_61-add-timeout-property-to-statepolicy","dir":"","previous_headings":"Phase 6: Error Handling & Timeouts","what":"6.1 Add timeout Property to StatePolicy","title":"TriCobbler Async Architecture TODO","text":"Location: R/class-policystate.R Steps: 1. Add property: timeout = S7::new_property(class = S7::class_integer, default = NA_integer_) (seconds) 2. run_stage_async dispatch, wrap runtime promise promises::promise_race(): r    (!.na(policy@timeout)) {      state_promise <- promises::promise_race(        runtime$run_async(),        promises::promise(function(resolve, reject) {          later::later(            function() reject(simpleError(\"Timeout N seconds\")),            delay = policy@timeout          )        })      )    } else {      state_promise <- runtime$run_async()    } 3. Timeout rejection handled normal failure — retry logic applies","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"id_62-partial-failure-policy","dir":"","previous_headings":"Phase 6: Error Handling & Timeouts","what":"6.2 Partial Failure Policy","title":"TriCobbler Async Architecture TODO","text":"Decision: Default optimistic — continue dispatching unless failed state critical. Non-critical failure: state recorded \"errored\" completed_set error condition result value. Dependents receive error condition can inspect . Critical failure: suspend() called. suspend handler (interactive programmatic) decides: resume, skip, abort. separate configuration needed — critical flag StatePolicy already provides per-state control.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"q1-on_failure-with-different-priorities--resolved","dir":"","previous_headings":"Resolved Design Questions","what":"Q1: on_failure with Different Priorities → Resolved","title":"TriCobbler Async Architecture TODO","text":"queue model eliminates priority-tier boundaries. on_failure targets simply enqueued ready queue dispatched dependencies met. Priority affects ordering within queue, grouping. priority: Safe — on_failure target enqueued dispatched next loop iteration. ’s already running (dispatched concurrently), skip jump log warning. Higher priority (already ran): target re-enqueued dispatched immediately (nothing blocks ). re-execution, re-visit priority tier. Lower priority (hasn’t run yet): Natural fit — runs dispatched queue priority order.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"q2-partial-parallel-failure--resolved","dir":"","previous_headings":"Resolved Design Questions","what":"Q2: Partial Parallel Failure → Resolved","title":"TriCobbler Async Architecture TODO","text":"Default optimistic: continue unless critical. See Phase 6.2.","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"q3-result-ordering--resolved","dir":"","previous_headings":"Resolved Design Questions","what":"Q3: Result Ordering → Resolved","title":"TriCobbler Async Architecture TODO","text":"Accepted expected async behavior. list_attachments() returns results ordered created_at timestamp (actual completion time). Priority order recorded policy metadata reference govern result ordering.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"unit-tests","dir":"","previous_headings":"Testing Strategy","what":"Unit Tests","title":"TriCobbler Async Architecture TODO","text":"tests/testthat/test-event-dispatcher.R — EventDispatcher: $(), $(), $emit(), $wrap(), condition propagation, restart invocation tests/testthat/test-lifecycle-conditions.R — Condition constructors, class hierarchy, testthat::expect_condition() integration tests/testthat/test-async-scheduler.R — Queue + pool dispatch mock agents tests/testthat/test-async-dependencies.R — depends_on blocks dispatch dependency completes tests/testthat/test-async-suspend.R — Suspend via condition system: listener-invoked restarts (resume/skip/abort/restart_stage), interactive fallback, -listener default tests/testthat/test-async-retry.R — Retry on_failure re-enqueue async mode tests/testthat/test-async-final.R — final = TRUE drains pool stops dispatch tests/testthat/test-async-timeout.R — Timeout via promise_race","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"integration-tests","dir":"","previous_headings":"Testing Strategy","what":"Integration Tests","title":"TriCobbler Async Architecture TODO","text":"Concurrent LLM calls complete faster sequential (wallclock comparison) AgentRuntime isolation: concurrent agents don’t corrupt ’s Chat state SQLite AttachmentIndex handles concurrent writes without corruption","code":""},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"mock-agent-helpers","dir":"","previous_headings":"Testing Strategy","what":"Mock Agent Helpers","title":"TriCobbler Async Architecture TODO","text":"","code":"# Async mock that simulates I/O delay mock_async_agent <- function(delay_secs = 0.1, result = \"ok\", fail = FALSE) {   as_agent(function(runtime) {     p <- promises::promise(function(resolve, reject) {       later::later(function() {         if (fail) reject(simpleError(\"mock failure\"))         else resolve(result)       }, delay = delay_secs)     })     return(p)  # run_async will await this   }, id = paste0(\"mock_\", sample.int(1e6, 1))) }"},{"path":[]},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"backward-compatibility","dir":"","previous_headings":"Migration Path","what":"Backward Compatibility","title":"TriCobbler Async Architecture TODO","text":"","code":"# Sync mode (default - unchanged) scheduler <- Scheduler$new(manifest, agents) scheduler$start()  # Blocking, sequential execution  # With lifecycle listeners scheduler <- Scheduler$new(manifest, agents) scheduler$on(\"state_completed\", function(cond) {   cat(\"Done:\", cond$data$state_name, \"\\n\") }) scheduler$on(\"suspend\", function(cond) {   invokeRestart(\"tricobbler_skip\")  # auto-skip for CI }) scheduler$start()  # Async mode (opt-in) scheduler <- Scheduler$new(manifest, agents, max_concurrency = 4L) promise <- scheduler$start_async()  # Returns promise # Run the event loop (in interactive R or plumber/shiny): coro::async_collect(promise) # Or in a script: promises::promise_all(promise) later::run_now()  # Drive the event loop"},{"path":"http://dipterix.org/tricobbler/TODO.html","id":"deprecation-schedule","dir":"","previous_headings":"Migration Path","what":"Deprecation Schedule","title":"TriCobbler Async Architecture TODO","text":"v1.x: accessibility = \"\" / \"logs\" continue working, emit deprecation warning async mode v2.x: Require accessibility = \"explicit\" depends_on agents read previous results async mode","code":""},{"path":"http://dipterix.org/tricobbler/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Dipterix Wang. Author, maintainer.","code":""},{"path":"http://dipterix.org/tricobbler/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Wang D (2026). tricobbler: Multi-Agent Workflow Orchestration Immutable Policy Definitions. R package version 0.0.0.9000, http://dipterix.org/tricobbler/.","code":"@Manual{,   title = {tricobbler: Multi-Agent Workflow Orchestration with Immutable Policy Definitions},   author = {Dipterix Wang},   year = {2026},   note = {R package version 0.0.0.9000},   url = {http://dipterix.org/tricobbler/}, }"},{"path":[]},{"path":"http://dipterix.org/tricobbler/copilot-instructions.html","id":"architecture-overview","dir":"","previous_headings":"","what":"Architecture Overview","title":"TriCobbler Package - Agent Guide","text":"Core Philosophy: Simplified workflow orchestration immutable policy blueprints (S7) mutable runtime execution (R6). Focus manifest→instance pattern. Two-Layer Architecture: 1. Policy Layer (S7): Manifest contains MasterPolicy + StatePolicy[] - See R/class-policy.R 2. Runtime Layer (R6): Scheduler orchestrates execution, Context persists results - See R/class-scheduler.R Data Flow: Manifest blueprint → Agents registered → Scheduler executes priority → Context records results","code":""},{"path":"http://dipterix.org/tricobbler/copilot-instructions.html","id":"critical-rules","dir":"","previous_headings":"","what":"Critical Rules","title":"TriCobbler Package - Agent Guide","text":"⚠️ MANDATORY FIRST STEP: Always read .github/copilot/DEVELOPMENT-RULES.md (lines 1-40) performing task - contains non-negotiable conventions prevent repeated mistakes. ENFORCEMENT RULE: MUST call read_file .github/copilot/DEVELOPMENT-RULES.md (lines 1-40) FIRST action user requests: - Documentation changes (roxygen2, .Rd files) - Spell checking (spellchk, spelling::spell_check_package()) - Code formatting style fixes - Adding/modifying package dependencies - Creating/editing examples - MCP tool changes proceed task read rules. checklist tells exactly handle scenario correctly.","code":""},{"path":"http://dipterix.org/tricobbler/copilot-instructions.html","id":"essential-guides","dir":"","previous_headings":"","what":"Essential Guides","title":"TriCobbler Package - Agent Guide","text":"Additional documentation available .github/copilot/ : - DevOps workflows (load, test, check, build) - See .github/copilot/DEVOPS-GUIDE.md - S7 vs R6 documentation examples - See .github/copilot/S7-R6-DOCUMENTATION.md","code":""},{"path":"http://dipterix.org/tricobbler/index.html","id":"tricobbler","dir":"","previous_headings":"","what":"Multi-Agent Workflow Orchestration with Immutable Policy Definitions","title":"Multi-Agent Workflow Orchestration with Immutable Policy Definitions","text":"word tricobbler comes Chinese proverb emphasizing collaboration among ordinary people can surpass intelligence single genius. Three cobblers wits combined equal Zhuge Liang 三个臭皮匠，顶个诸葛亮 goal tricobbler combine ","code":""},{"path":"http://dipterix.org/tricobbler/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Multi-Agent Workflow Orchestration with Immutable Policy Definitions","text":"can install development version tricobbler like :","code":"# FILL THIS IN! HOW CAN PEOPLE INSTALL YOUR DEV PACKAGE?"},{"path":"http://dipterix.org/tricobbler/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Multi-Agent Workflow Orchestration with Immutable Policy Definitions","text":"basic example shows solve common problem:","code":"library(tricobbler) ## basic example code"},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":null,"dir":"Reference","previous_headings":"","what":"Agent Function Wrapper for State Execution — Agent","title":"Agent Function Wrapper for State Execution — Agent","text":"Creates executable agent can registered Scheduler execute state-specific logic. agent wraps user-defined function metadata (id, description) result formatting. Agents execution units Runtime Layer (Tier 2) implement logic defined StatePolicy objects Policy Layer (Tier 1).","code":""},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Agent Function Wrapper for State Execution — Agent","text":"","code":"Agent(   .data = function() NULL,   id = character(0),   description = character(0),   describe = tricobbler::mcp_describe )"},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Agent Function Wrapper for State Execution — Agent","text":".data function, agent implementation signature function(runtime, ...) id character, unique identifier agent (letters, digits, underscores, dashes ) description character, human-readable description agent describe function NULL, result formatting function logging; defaults mcp_describe. provided, take result first argument return character string","code":""},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Agent Function Wrapper for State Execution — Agent","text":"Agent object (S7 class inheriting function)","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"agent-function-signature","dir":"Reference","previous_headings":"","what":"Agent Function Signature","title":"Agent Function Wrapper for State Execution — Agent","text":"wrapped function must following signature: Required arguments: runtime: AgentRuntime object containing: runtime$agent: Reference agent object runtime$policy: StatePolicy object executed runtime$context: Context object logging runtime$logger(): Method log messages ...: Additional arguments (optional)","code":"function(runtime, ...) {   # Agent implementation   # runtime$agent - the Agent object itself   # runtime$policy - the StatePolicy being executed    # runtime$context - the Context for logging   # runtime$logger() - shorthand for logging   # Return value will be logged to context via @describe }"},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"agent-execution-flow","dir":"Reference","previous_headings":"","what":"Agent Execution Flow","title":"Agent Function Wrapper for State Execution — Agent","text":"Scheduler executes state: Looks agent StatePolicy@agent_id Creates AgentRuntime agent, policy, context Calls agent function (runtime) Captures return value Uses describe function format result logging Logs formatted result Context","code":""},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"result-description","dir":"Reference","previous_headings":"","what":"Result Description","title":"Agent Function Wrapper for State Execution — Agent","text":"describe property controls results formatted AI-readable logs. default, uses mcp_describe captures printed results. describe property serves three purposes: first, function allows agent format output better AI-readability. formatted results logged public log file along scheduling messages; second, agent can choose redact sensitive information avoid insecure agents access data - reading attachments requires permissions agents (according implemented) access attachments; finally, output description recorded public log file agents can still refer context without reading corresponding attachment file. example local agent's output contains user-sensitive data, describe function may hide information string replacement, simply show data format schema. online-agents may still see redacted outputs log files work output (writing code executing tools).","code":""},{"path":"http://dipterix.org/tricobbler/reference/Agent.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Agent Function Wrapper for State Execution — Agent","text":"","code":"# Basic agent simple_agent <- Agent(   function(runtime) {     runtime$logger(\"Executing simple task\")     return(\"Task completed\")   },   id = \"simple_agent\",   description = \"A simple demonstration agent\" )   # Agent with custom result formatting function analysis_agent <- Agent(   function(runtime) {     result <- list(       status = \"success\",       items_processed = 42,       timestamp = Sys.time(),       long_result = rnorm(100),       sensitive_data = \"my password\"     )     return(result)   },   id = \"analysis_agent\",   description = \"Performs data analysis\",   describe = function(result) {     result$sensitive_data <- \"<password redacted...>\"     c(       sprintf(\"Processed %d items at %s.\\n\",               result$items_processed, result$timestamp),       \"Here are the snapshots with R str():\",       utils::capture.output(str(result))     )   } )  # run these agents manifest <- Manifest(   master = MasterPolicy(     name = \"example\",     version = \"0.0.1\",     stages = \"executing\"   ),   states = list(     StatePolicy(name = \"simply_policy\",                 stage = \"executing\",                 agent_id = \"simple_agent\"),     StatePolicy(name = \"analysis_policy\",                 stage = \"executing\",                 agent_id = \"analysis_agent\")   ) )  scheduler <- Scheduler$new(manifest = manifest,                            agents = list(simple_agent, analysis_agent))  if(interactive()) {   scheduler$start()   # TRACE 10:53:15 [scheduler]: Initializing resources   # TRACE 10:53:15 [scheduler]: current stage: executing   # TRACE 10:53:15 [scheduler]: starting state: simply_policy with   #  agent simple_agent (attempt 0)   # INFO 10:53:15 [Agent simple_agent]: Executing simple task   # INFO 10:53:15 [context]: Following result recorded:   #  Agent=simple_agent, stage=executing,   #  state=simply_policy, attempt=0,   #  identifier=[executing][simply_policy][simple_agent]_20T105315_0   # INFO 10:53:15 [context]: \"Task completed\"   # TRACE 10:53:15 [scheduler]: starting state: analysis_policy with   #  agent analysis_agent (attempt 0)   # INFO 10:53:15 [context]: Following result recorded:   #  Agent=analysis_agent, stage=executing,   #  state=analysis_policy, attempt=0,   #  identifier=[executing][analysis_policy][analysis_agent]_20T105315_0   # INFO 10:53:15 [context]: Processed 42 items at 10:53:15.   # INFO 10:53:15 [context]: Here are the snapshots with R str():   #  List of 5 $ status :   #    chr \"success\" $ items_processed: num 42   #    $ timestamp : POSIXct[1:1], format: \"2026-02-03 10:53:15\"   #    $ long_result : num [1:100] 0.372 0.504 -1.584 -0.728 0.18 ...   #    $ sensitive_data : chr \"<password redacted...>\"   # TRACE 10:53:15 [scheduler]: current stage: ready }"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":null,"dir":"Reference","previous_headings":"","what":"Execution Context for Workflow State Management — AgentContext","title":"Execution Context for Workflow State Management — AgentContext","text":"R6 class manages execution environment workflow states. Provides logging, result storage, attachment management workflow execution. part Runtime Layer (Tier 2) alongside Scheduler.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"public-fields","dir":"Reference","previous_headings":"","what":"Public fields","title":"Execution Context for Workflow State Management — AgentContext","text":"debug logical, whether print agent calls","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"active-bindings","dir":"Reference","previous_headings":"","what":"Active bindings","title":"Execution Context for Workflow State Management — AgentContext","text":"id character, unique identifier context (read-) rootpath character, root directory context storage (read-) current_stage character, currently executing stage scheduler (read-) current_state character, currently executing state scheduler (read-) memory_path character, path shared memory directory, used store agent memories across sessions (read-) is_default_context logical, whether default context (read-) cache map, stores persists temporary data store_path character, path context's conversation directory (read-) logger_path character, path log file (read-) attachment_path character, path attachments directory (read-) index AttachmentIndex, attachment index (read-). Available init_resources() called.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"public-methods","dir":"Reference","previous_headings":"","what":"Public methods","title":"Execution Context for Workflow State Management — AgentContext","text":"AgentContext$set_scheduler() AgentContext$new() AgentContext$init_resources() AgentContext$logger() AgentContext$record_attachment() AgentContext$last_results() AgentContext$get_attachment() AgentContext$get_attachment_by_state() AgentContext$list_attachments() AgentContext$has_attachment() AgentContext$list_incomplete() AgentContext$get_runtime_log() AgentContext$read_logs()","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-set-scheduler-","dir":"Reference","previous_headings":"","what":"Method set_scheduler()","title":"Execution Context for Workflow State Management — AgentContext","text":"Associate scheduler context","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$set_scheduler(scheduler)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"scheduler Scheduler object associate","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-new-","dir":"Reference","previous_headings":"","what":"Method new()","title":"Execution Context for Workflow State Management — AgentContext","text":"Initialize new context","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-1","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$new(   id = NULL,   path = file.path(tempdir(), \"tricobbler\", \"context\") )"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-1","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"id character, unique identifier (NULL auto-generate) path character, root directory path (NULL default cache)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-init-resources-","dir":"Reference","previous_headings":"","what":"Method init_resources()","title":"Execution Context for Workflow State Management — AgentContext","text":"Create directory structure initialize logging","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-2","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$init_resources()"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-logger-","dir":"Reference","previous_headings":"","what":"Method logger()","title":"Execution Context for Workflow State Management — AgentContext","text":"Write time-stamped messages log file","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-3","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$logger(   ...,   caller,   level = c(\"INFO\", \"TRACE\", \"DEBUG\", \"WARN\", \"ERROR\", \"FATAL\"),   verbose = c(\"cli\", \"base\", \"none\") )"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-2","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"... character, message components paste together caller object, caller (scheduler, context, agent) level character, log level (INFO, WARN, ERROR, FATAL) verbose character logical, whether verbose log results R console. logical TRUE, equivalent 'cli' (default), uses cli package colored/styled console outputs. cli installed, falls back 'base'. logical FALSE character 'none', logs printed . Use 'base' force plain cat()/message() output without styling.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-record-attachment-","dir":"Reference","previous_headings":"","what":"Method record_attachment()","title":"Execution Context for Workflow State Management — AgentContext","text":"Record attachment result completed runtime","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-4","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$record_attachment(runtime, succeed)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-3","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"runtime AgentRuntime object produced attachment succeed logical, whether agent execution succeeded","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-last-results-","dir":"Reference","previous_headings":"","what":"Method last_results()","title":"Execution Context for Workflow State Management — AgentContext","text":"Retrieve recent result(s)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-5","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$last_results(items = 1, simplify = length(items) == 1)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-4","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"items integer, number results retrieve simplify logical, return single result items == 1","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-get-attachment-","dir":"Reference","previous_headings":"","what":"Method get_attachment()","title":"Execution Context for Workflow State Management — AgentContext","text":"Retrieve specific attachment identifier","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-6","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$get_attachment(attachment_id)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-5","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"attachment_id character, attachment identifier (filename record_result). StatePolicy object retrieve latest attachment state.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-get-attachment-by-state-","dir":"Reference","previous_headings":"","what":"Method get_attachment_by_state()","title":"Execution Context for Workflow State Management — AgentContext","text":"Retrieve latest attachment specific state","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-7","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$get_attachment_by_state(state, stage)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-6","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"state character, name state stage character, optional stage name narrow search","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-list-attachments-","dir":"Reference","previous_headings":"","what":"Method list_attachments()","title":"Execution Context for Workflow State Management — AgentContext","text":"List available attachments","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-8","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$list_attachments(reindex = FALSE)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-7","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"reindex logical, currently unused (index always live); kept backward compatibility","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-has-attachment-","dir":"Reference","previous_headings":"","what":"Method has_attachment()","title":"Execution Context for Workflow State Management — AgentContext","text":"Check attachment exists","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-9","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$has_attachment(attachment_id)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-8","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"attachment_id character, attachment identifier","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"returns","dir":"Reference","previous_headings":"","what":"Returns","title":"Execution Context for Workflow State Management — AgentContext","text":"logical, TRUE attachment exists disk, FALSE otherwise","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-list-incomplete-","dir":"Reference","previous_headings":"","what":"Method list_incomplete()","title":"Execution Context for Workflow State Management — AgentContext","text":"Find incomplete executions (crashed -progress)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-10","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$list_incomplete(timeout_secs = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-9","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"timeout_secs numeric NULL, seconds init/running entries considered incomplete. NULL, returns init/running entries.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"returns-1","dir":"Reference","previous_headings":"","what":"Returns","title":"Execution Context for Workflow State Management — AgentContext","text":"data.frame incomplete index entries","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-get-runtime-log-","dir":"Reference","previous_headings":"","what":"Method get_runtime_log()","title":"Execution Context for Workflow State Management — AgentContext","text":"Read per-execution log file specific runtime","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-11","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$get_runtime_log(attachment_id)"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-10","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"attachment_id character, attachment identifier (also log file prefix runtime)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"returns-2","dir":"Reference","previous_headings":"","what":"Returns","title":"Execution Context for Workflow State Management — AgentContext","text":"character vector log lines, NULL found","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"method-read-logs-","dir":"Reference","previous_headings":"","what":"Method read_logs()","title":"Execution Context for Workflow State Management — AgentContext","text":"Read parse log file contents","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"usage-12","dir":"Reference","previous_headings":"","what":"Usage","title":"Execution Context for Workflow State Management — AgentContext","text":"","code":"AgentContext$read_logs(   method = c(\"tail\", \"head\"),   skip_lines = 0L,   max_lines = 300L,   pattern = NULL,   levels = c(\"TRACE\", \"DEBUG\", \"INFO\", \"WARN\", \"ERROR\", \"FATAL\") )"},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"arguments-11","dir":"Reference","previous_headings":"","what":"Arguments","title":"Execution Context for Workflow State Management — AgentContext","text":"method character, read \"tail\" (end) \"head\" (beginning) skip_lines integer, skipping lines relative end start; method \"head\", skip skips first several lines, otherwise skipping last several lines; default 0L (skipping). max_lines integer, maximum number lines read (default 300) pattern character, optional regex pattern filter log content levels character, log levels include (default: levels)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentContext.html","id":"returns-3","dir":"Reference","previous_headings":"","what":"Returns","title":"Execution Context for Workflow State Management — AgentContext","text":"data.frame columns: line_no, level, time, caller, content. Returns empty data.frame file missing matches.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":null,"dir":"Reference","previous_headings":"","what":"Agent Runtime Environment for State Execution — AgentRuntime","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"R6 class provides isolated execution environment agent execution. Contains references executing agent (), context (), policy (). class instantiated per-execution passed agents, enabling async-safe execution without relying global state.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"purpose","dir":"Reference","previous_headings":"","what":"Purpose","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"runtime serves three main purposes: Async safety: Captures execution context closures, avoiding race conditions global state agents execute concurrently Simplified API: Agents receive single runtime argument instead separate self, policy, context arguments Tool injection: MCP tools declare .runtime parameter receive runtime automatically via closure capture instantiation time","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"tool-runtime-injection","dir":"Reference","previous_headings":"","what":"Tool Runtime Injection","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"mcptool_instantiate creates tool wrappers, checks underlying function .runtime formal parameter. , runtime automatically injected calls. allows downstream packages create MCP tools access execution context:","code":"my_mcp_tool <- function(arg1, arg2, .runtime = NULL) {   if (!is.null(.runtime)) {     .runtime$logger(\"Tool called with runtime access\")     ctx <- .runtime$context   }   # ... tool implementation }"},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"active-bindings","dir":"Reference","previous_headings":"","what":"Active bindings","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"agent Agent object, agent executed () context AgentContext object, execution context () policy StatePolicy object, policy executed () attempt integer, retry count failed attachment_id character, attachment prefix id character, short identifier execution show context logs status character, current runtime status (\"idle\", \"running\", \"completed\")","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"public-methods","dir":"Reference","previous_headings":"","what":"Public methods","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"AgentRuntime$new() AgentRuntime$logger() AgentRuntime$run_async() AgentRuntime$run()","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"method-new-","dir":"Reference","previous_headings":"","what":"Method new()","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"Initialize new runtime environment","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"","code":"AgentRuntime$new(agent, context, policy, attempt = 0L)"},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"agent Agent object executed context AgentContext object logging storage policy StatePolicy object executed attempt integer, retry count (default: 0L)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"method-logger-","dir":"Reference","previous_headings":"","what":"Method logger()","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"Log message agent caller","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"usage-1","dir":"Reference","previous_headings":"","what":"Usage","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"","code":"AgentRuntime$logger(   ...,   level = c(\"INFO\", \"TRACE\", \"DEBUG\", \"WARN\", \"ERROR\", \"FATAL\"),   verbose = c(\"cli\", \"base\", \"none\"),   public = TRUE,   role = NA_character_ )"},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"arguments-1","dir":"Reference","previous_headings":"","what":"Arguments","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"... character, message components paste together level character, log level (INFO, WARN, ERROR, FATAL, DEBUG) verbose character logical, verbosity setting public logical, whether also log context log role character, role label log entry","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"returns","dir":"Reference","previous_headings":"","what":"Returns","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"NULL invisibly","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"method-run-async-","dir":"Reference","previous_headings":"","what":"Method run_async()","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"Execute agent asynchronously, returning promise resolves recorded attachment","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"usage-2","dir":"Reference","previous_headings":"","what":"Usage","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"","code":"AgentRuntime$run_async()"},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"returns-1","dir":"Reference","previous_headings":"","what":"Returns","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"promises::promise object","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"method-run-","dir":"Reference","previous_headings":"","what":"Method run()","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"Execute agent synchronously, blocking completion returning recorded attachment","code":""},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"usage-3","dir":"Reference","previous_headings":"","what":"Usage","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"","code":"AgentRuntime$run()"},{"path":"http://dipterix.org/tricobbler/reference/AgentRuntime.html","id":"returns-2","dir":"Reference","previous_headings":"","what":"Returns","title":"Agent Runtime Environment for State Execution — AgentRuntime","text":"attachment list (invisibly)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":null,"dir":"Reference","previous_headings":"","what":"Async Workflow Execution Scheduler — AsyncScheduler","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"R6 class extends Scheduler promise-based asynchronous execution. Within stage, independent states dispatched concurrently via AgentRuntime$run_async(), bounded max_concurrency. Stages executed sequentially.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"TODO: explain cycle","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"super-class","dir":"Reference","previous_headings":"","what":"Super class","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"tricobbler::TricobblerScheduler -> TricobblerAsyncScheduler","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"methods","dir":"Reference","previous_headings":"","what":"Methods","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"tricobbler::TricobblerScheduler$dispatch_event() tricobbler::TricobblerScheduler$enqueue_runtime() tricobbler::TricobblerScheduler$get_incomplete_size() tricobbler::TricobblerScheduler$init_resources() tricobbler::TricobblerScheduler$init_stage() tricobbler::TricobblerScheduler$initialize() tricobbler::TricobblerScheduler$() tricobbler::TricobblerScheduler$() tricobbler::TricobblerScheduler$retry_runtime() tricobbler::TricobblerScheduler$start_stage() tricobbler::TricobblerScheduler$validate()","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"public-methods","dir":"Reference","previous_headings":"","what":"Public methods","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"AsyncScheduler$stop() AsyncScheduler$start() AsyncScheduler$execute_runtime() AsyncScheduler$advance() AsyncScheduler$run_stage() AsyncScheduler$suspend()","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-stop-","dir":"Reference","previous_headings":"","what":"Method stop()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Stop workflow execution, clearing -progress work rejecting active stage promise. calling stop(), scheduler \"ready\" state start() may called immediately.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$stop()"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-start-","dir":"Reference","previous_headings":"","what":"Method start()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Start workflow execution","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage-1","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$start()"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"returns","dir":"Reference","previous_headings":"","what":"Returns","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"promise resolves stages complete. Callers may block via later::run_now() await() inside coro::async context.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-execute-runtime-","dir":"Reference","previous_headings":"","what":"Method execute_runtime()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Dispatch queued runtimes async promises.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage-2","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$execute_runtime()"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"returns-1","dir":"Reference","previous_headings":"","what":"Returns","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"integer, number runtimes dispatched (invisibly)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-advance-","dir":"Reference","previous_headings":"","what":"Method advance()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Drive next async dispatch cycle.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage-3","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$advance()"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"details-1","dir":"Reference","previous_headings":"","what":"Details","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Called promise callbacks runtime settles. Runs: retry -> enqueue -> execute. incomplete work remains, resolves stage promise.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-run-stage-","dir":"Reference","previous_headings":"","what":"Method run_stage()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Execute single workflow stage asynchronously.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage-4","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$run_stage(stage)"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"stage character, stage name execute","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"returns-2","dir":"Reference","previous_headings":"","what":"Returns","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"promise resolves states stage completed","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"method-suspend-","dir":"Reference","previous_headings":"","what":"Method suspend()","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"Suspend workflow execution (async version).","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"usage-5","dir":"Reference","previous_headings":"","what":"Usage","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"","code":"AsyncScheduler$suspend(   error = NULL,   state_name = NA_character_,   stage = self$current_stage,   runtime_summary = NULL )"},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"arguments-1","dir":"Reference","previous_headings":"","what":"Arguments","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"error condition character, error caused suspension state_name character, state caused suspension stage character, stage suspension occurred runtime_summary list NULL, lightweight summary failed runtime","code":""},{"path":"http://dipterix.org/tricobbler/reference/AsyncScheduler.html","id":"returns-3","dir":"Reference","previous_headings":"","what":"Returns","title":"Async Workflow Execution Scheduler — AsyncScheduler","text":"character, chosen action (invisibly)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":null,"dir":"Reference","previous_headings":"","what":"Attachment Index for Workflow Result Tracking — AttachmentIndex","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"R6 class manages attachment index workflow execution. Backed RSQLite, class provides atomic, query-friendly tracking attachment lifecycle status. database access uses open/close-per-operation pattern safety.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"index tracks attachment lifecycle: init Runtime created, execution yet started running Agent execution progress finished Execution completed successfully errored Execution completed error skipped Execution skipped (reserved future use)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"backend-abstraction","dir":"Reference","previous_headings":"","what":"Backend Abstraction","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"SQLite calls isolated behind private $.with_db() method. swap backends (e.g., duckdb), $.with_db() $.init_db() need modification.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"public-methods","dir":"Reference","previous_headings":"","what":"Public methods","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"AttachmentIndex$new() AttachmentIndex$register() AttachmentIndex$update_status() AttachmentIndex$mark_finished() AttachmentIndex$get() AttachmentIndex$list() AttachmentIndex$query() AttachmentIndex$list_incomplete() AttachmentIndex$exists() AttachmentIndex$get_db_path()","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-new-","dir":"Reference","previous_headings":"","what":"Method new()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Initialize attachment index","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$new(db_path)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"db_path character, path SQLite database file","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-register-","dir":"Reference","previous_headings":"","what":"Method register()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Register new attachment entry status 'init'","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-1","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$register(attachment_id, stage, state, agent_id, attempt = 0L)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-1","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"attachment_id character, unique attachment identifier stage character, stage name state character, state name agent_id character, agent identifier attempt integer, attempt number","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-update-status-","dir":"Reference","previous_headings":"","what":"Method update_status()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Update status existing attachment","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-2","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$update_status(attachment_id, status)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-2","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"attachment_id character, attachment identifier status character, new status","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-mark-finished-","dir":"Reference","previous_headings":"","what":"Method mark_finished()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Mark attachment finished errored","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-3","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$mark_finished(attachment_id, succeed)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-3","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"attachment_id character, attachment identifier succeed logical, whether execution succeeded","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-get-","dir":"Reference","previous_headings":"","what":"Method get()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Retrieve single index entry","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-4","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$get(attachment_id)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-4","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"attachment_id character, attachment identifier","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"single-row data.frame NULL found","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-list-","dir":"Reference","previous_headings":"","what":"Method list()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"List index entries","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-5","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$list(status = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-5","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"status character NULL, optional status filter","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns-1","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"data.frame matching entries (recent first)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-query-","dir":"Reference","previous_headings":"","what":"Method query()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Query index entries state /stage","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-6","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$query(state, stage = NULL, status = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-6","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"state character, state name filter stage character NULL, optional stage filter status character NULL, optional status filter","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns-2","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"data.frame matching entries (recent first)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-list-incomplete-","dir":"Reference","previous_headings":"","what":"Method list_incomplete()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Find incomplete entries (init running past timeout)","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-7","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$list_incomplete(timeout_secs = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-7","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"timeout_secs numeric, seconds init/running entries considered incomplete. NULL (default), returns entries status 'init' 'running' regardless age.","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns-3","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"data.frame incomplete entries","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-exists-","dir":"Reference","previous_headings":"","what":"Method exists()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Check attachment exists index","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-8","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$exists(attachment_id)"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"arguments-8","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"attachment_id character, attachment identifier","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns-4","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"logical","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"method-get-db-path-","dir":"Reference","previous_headings":"","what":"Method get_db_path()","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"Get database file path","code":""},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"usage-9","dir":"Reference","previous_headings":"","what":"Usage","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"","code":"AttachmentIndex$get_db_path()"},{"path":"http://dipterix.org/tricobbler/reference/AttachmentIndex.html","id":"returns-5","dir":"Reference","previous_headings":"","what":"Returns","title":"Attachment Index for Workflow Result Tracking — AttachmentIndex","text":"character, path SQLite database","code":""},{"path":"http://dipterix.org/tricobbler/reference/BasePolicy.html","id":null,"dir":"Reference","previous_headings":"","what":"Abstract Base Class for Policy Objects — BasePolicy","title":"Abstract Base Class for Policy Objects — BasePolicy","text":"Internal abstract base class policy objects. defines common properties name description shared concrete subclasses. class exported intended internal use .","code":""},{"path":"http://dipterix.org/tricobbler/reference/BasePolicy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Abstract Base Class for Policy Objects — BasePolicy","text":"","code":"BasePolicy(name = character(0), description = character(0))"},{"path":"http://dipterix.org/tricobbler/reference/BasePolicy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Abstract Base Class for Policy Objects — BasePolicy","text":"name Character. Must non-blank single string. description Character. Human-readable description; multiple values collapsed single space-separated string.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":null,"dir":"Reference","previous_headings":"","what":"Validated Container Linking Master Policy to State Policies — Manifest","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"Container ties MasterPolicy together list StatePolicy objects. validation ensures every stage defined master policy represented least one state.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"","code":"Manifest(master = MasterPolicy(), states = list())"},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"master MasterPolicy object states list StatePolicy objects","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"two-tier-architecture","dir":"Reference","previous_headings":"","what":"Two-Tier Architecture","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"Manifest class represents validated blueprint layer (Tier 1) package two-tier design: Policy Layer (Tier 1 - Immutable S7): Blueprint definitions Manifest: Validated container linking MasterPolicy StatePolicy list MasterPolicy: Workflow version + allowed stages (macro-level phases) StatePolicy: Individual state metadata (stage, description, parameters, priority) Runtime Layer (Tier 2 - Mutable R6): Execution orchestration Scheduler: Orchestrates stage/state progression workflow execution Context: Manages execution environment (logging, storage, attachments) Agent: Executes state-specific logic","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"stages-vs-states-critical-distinction","dir":"Reference","previous_headings":"","what":"Stages vs States: Critical Distinction","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"Stages (symbolic vocabulary): Workflow phase names defined MasterPolicy@stages (e.g., \"triage\", \"planning\", \"executing\") States (concrete implementations): StatePolicy objects reference stages add execution metadata (description, parameters, priority) Multiple states per stage: Enables different execution patterns: Sequential fallback: Different priorities create ordered execution Critical gates: Critical states enforce fail-fast validation semantics Validation rule: Every stage MasterPolicy@stages MUST least one corresponding StatePolicy (enforced validation)","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"validation-rules","dir":"Reference","previous_headings":"","what":"Validation Rules","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"Manifest validation performs critical cross-checks: Completeness: Every MasterPolicy stage least one StatePolicy Prevents \"orphaned\" stages implementation Error message: \"Missing stages: ...\" Critical priority uniqueness: Critical states share priorities StatePolicy@critical = TRUE, state stage can priority value Prevents ambiguity critical state blocks lower-priority states Error message: \"Critical state ... share priority ...\"","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"immutability-and-serialization","dir":"Reference","previous_headings":"","what":"Immutability and Serialization","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"created, Manifest objects immutable (S7 value semantics), providing stable reference runtime execution. Manifests can serialized /YAML version control: manifest_write(manifest, file): Save human-readable YAML manifest_read(file): Load full validation validation rules apply reading YAML","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"policy-vs-runtime-separation","dir":"Reference","previous_headings":"","what":"Policy vs Runtime Separation","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"Manifest policy-level blueprint defines workflow (stages states), executes. actual execution (orchestration, logging, state management) handled Scheduler Context Runtime layer.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Manifest.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Validated Container Linking Master Policy to State Policies — Manifest","text":"","code":"# Create a valid manifest mp <- MasterPolicy(   name = \"example\", version = \"1.0.0\",   stages = c(\"idle\", \"triage\"), parameters = list() ) sp1 <- StatePolicy(   name = \"state1\", stage = \"idle\",   description = \"idle state\", agent_id = \"agent1\" ) sp2 <- StatePolicy(   name = \"state2\", stage = \"triage\",   description = \"triage state\", agent_id = \"agent2\" ) mf <- Manifest(master = mp, states = list(sp1, sp2)) mf #> Manifest (S7 class) - `example` (1.0.0) #>  #> Master policy stages:  #>   idle, triage #>  #> State `idle` #>   - State: `state1` (priority: 100) #> State `triage` #>   - State: `state2` (priority: 100)"},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":null,"dir":"Reference","previous_headings":"","what":"Master Workflow Policy Defining Stages and Version — MasterPolicy","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"Concrete policy defines overall workflow version set allowed stages. Inherits BasePolicy.","code":""},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"","code":"MasterPolicy(   name = character(0),   description = character(0),   version = character(0),   stages = c(\"triage\", \"planning\", \"executing\"),   parameters = list() )"},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"name Character. Name policy (non-blank). description Character. Human-readable description. version Character. Version string validated property_version(). stages Character vector. Non-empty, lower-cased, unique, element may contain letters, digits, underscores dashes. parameters List. Additional free-form parameters workflow.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"stages-as-workflow-vocabulary","dir":"Reference","previous_headings":"","what":"Stages as Workflow Vocabulary","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"stages property defines symbolic vocabulary workflow phases (e.g., \"triage\", \"planning\", \"executing\"). macro-level phase names must implemented least one StatePolicy object Manifest.","code":""},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"stage-naming-conventions","dir":"Reference","previous_headings":"","what":"Stage Naming Conventions","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"Stages automatically converted lowercase consistency Must contain letters (-z), digits (0-9), underscores (_), dashes (-) Must unique (case-insensitive) within workflow blank NA","code":""},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"immutability","dir":"Reference","previous_headings":"","what":"Immutability","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"MasterPolicy objects immutable (S7 value semantics). created, serve stable reference Contract objects. Use @ accessor read properties (e.g., policy@stages).","code":""},{"path":"http://dipterix.org/tricobbler/reference/MasterPolicy.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Master Workflow Policy Defining Stages and Version — MasterPolicy","text":"","code":"MasterPolicy(   name = \"example\",   version = \"1.0.0\",   stages = c(\"idle\", \"triage\", \"planning\"),   parameters = list() ) #> MasterPolicy (S7 class) - `example`(1.0.0) #> Stages: idle, triage, planning"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":null,"dir":"Reference","previous_headings":"","what":"Synchronous Workflow Scheduler — Scheduler","title":"Synchronous Workflow Scheduler — Scheduler","text":"R6 class orchestrates sequential execution workflow stages states. Manages lifecycle agent runtimes priority-based dispatch, dependency resolution, retry logic, critical-state suspension. synchronous (blocking) scheduler; see AsyncScheduler promise-based variant.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"public-fields","dir":"Reference","previous_headings":"","what":"Public fields","title":"Synchronous Workflow Scheduler — Scheduler","text":"manifest Manifest, workflow blueprint agents fastmap::fastmap() object, registry Agent objects keyed agent_id context Context, execution environment logging storage current_stage character, currently executing stage name stage_started POSIXct, timestamp current stage started suspended logical, whether execution paused suspend_info list NULL, context captured scheduler suspends (state_name, stage, error). Cleared resume/skip. draining logical, TRUE final state completed; new runtimes dispatched remaining queued items abandoned max_concurrency integer, maximum number states dispatch per advance cycle (default: 100L) runtime_map fastmap::fastmap() object, runtimes current stage joining ready queue ready_queue fastmap::fastqueue() object, priority-sorted queue runtimes ready execute waiting_pool fastmap::fastmap() object, tracks currently executing runtimes completed_map fastmap::fastmap() object, maps state names completion records status (\"finished\", \"errored\", \"skipped\") retry_map fastmap::fastmap() object, maps state names integer attempt counts retry scheduling","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"public-methods","dir":"Reference","previous_headings":"","what":"Public methods","title":"Synchronous Workflow Scheduler — Scheduler","text":"Scheduler$new() Scheduler$() Scheduler$() Scheduler$dispatch_event() Scheduler$validate() Scheduler$stop() Scheduler$start() Scheduler$init_resources() Scheduler$init_stage() Scheduler$enqueue_runtime() Scheduler$execute_runtime() Scheduler$retry_runtime() Scheduler$start_stage() Scheduler$get_incomplete_size() Scheduler$advance() Scheduler$run_stage() Scheduler$suspend()","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-new-","dir":"Reference","previous_headings":"","what":"Method new()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Initialize scheduler manifest blueprint agents","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$new(manifest, agents = list(), context = AgentContext$new())"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"manifest Manifest object, workflow blueprint agents list, collection Agent objects context Context object, execution environment (default: new AgentContext)","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-on-","dir":"Reference","previous_headings":"","what":"Method on()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Register listener lifecycle event","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-1","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$on(type, handler, id = NULL, after = TRUE)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-1","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"type character, event type (e.g. \"suspend\", \"state_completed\", \"stage_completed\", \"dispatch\") handler function, callback receiving event list. \"suspend\" events handler may return action string (\"resume\", \"skip\", \"abort\", \"restart_stage\"). id character NULL, optional listener ID replacement removal; auto-generated via digest::digest(handler) NULL logical, TRUE (default) append handler existing handlers; FALSE prepend ","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"returns","dir":"Reference","previous_headings":"","what":"Returns","title":"Synchronous Workflow Scheduler — Scheduler","text":"character, listener ID (invisibly)","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-off-","dir":"Reference","previous_headings":"","what":"Method off()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Remove registered lifecycle listener ID","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-2","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$off(id)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-2","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"id character, listener ID returned $()","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-dispatch-event-","dir":"Reference","previous_headings":"","what":"Method dispatch_event()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Emit lifecycle event registered listeners","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-3","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$dispatch_event(type, message = type, ...)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-3","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"type character, event type identifier message character, human-readable event description ... additional named fields attached event","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-validate-","dir":"Reference","previous_headings":"","what":"Method validate()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Verify required agents registered","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-4","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$validate(on_error = c(\"error\", \"quiet\"))"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-4","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"on_error character, action validation failure (\"error\" \"quiet\")","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-stop-","dir":"Reference","previous_headings":"","what":"Method stop()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Stop workflow execution, clearing -progress work invalidating outstanding promises. calling stop(), scheduler \"ready\" state start() may called immediately.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-5","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$stop()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-start-","dir":"Reference","previous_headings":"","what":"Method start()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Start workflow execution","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-6","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$start()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-init-resources-","dir":"Reference","previous_headings":"","what":"Method init_resources()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Initialize resources prepare execution","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-7","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$init_resources(reset_context = FALSE)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-5","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"reset_context logical, whether reset context storage","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-init-stage-","dir":"Reference","previous_headings":"","what":"Method init_stage()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Initialize single stage creating runtimes state policies stage","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-8","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$init_stage(stage)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-6","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"stage character, stage name initialize","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-enqueue-runtime-","dir":"Reference","previous_headings":"","what":"Method enqueue_runtime()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Move ready runtimes runtime_map ready_queue based dependency satisfaction","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-9","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$enqueue_runtime()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-execute-runtime-","dir":"Reference","previous_headings":"","what":"Method execute_runtime()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Dispatch runtimes ready_queue waiting_pool execution (max_concurrency)","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-10","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$execute_runtime()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"returns-1","dir":"Reference","previous_headings":"","what":"Returns","title":"Synchronous Workflow Scheduler — Scheduler","text":"integer, number runtimes dispatched","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-retry-runtime-","dir":"Reference","previous_headings":"","what":"Method retry_runtime()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Re-enqueue runtimes retry_map back runtime_map incremented attempt counts","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-11","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$retry_runtime()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-start-stage-","dir":"Reference","previous_headings":"","what":"Method start_stage()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Prepare validate stage execution","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-12","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$start_stage(stage)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-7","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"stage character, stage name start","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-get-incomplete-size-","dir":"Reference","previous_headings":"","what":"Method get_incomplete_size()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Count incomplete work items current stage","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-13","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$get_incomplete_size()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"returns-2","dir":"Reference","previous_headings":"","what":"Returns","title":"Synchronous Workflow Scheduler — Scheduler","text":"integer, total items across runtime_map, ready_queue, waiting_pool, retry_map","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-advance-","dir":"Reference","previous_headings":"","what":"Method advance()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Drive dispatch loop current stage.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-14","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$advance()"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Synchronous Workflow Scheduler — Scheduler","text":"Loops synchronously: retry -> enqueue -> execute, checks stage completion. Continues work remains stage cancelled/suspended.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-run-stage-","dir":"Reference","previous_headings":"","what":"Method run_stage()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Execute single workflow stage using queue + waiting-pool dispatch model","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-15","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$run_stage(stage)"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-8","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"stage character, stage name execute","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"method-suspend-","dir":"Reference","previous_headings":"","what":"Method suspend()","title":"Synchronous Workflow Scheduler — Scheduler","text":"Suspend workflow execution","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"usage-16","dir":"Reference","previous_headings":"","what":"Usage","title":"Synchronous Workflow Scheduler — Scheduler","text":"","code":"Scheduler$suspend(   error = NULL,   state_name = NA_character_,   stage = self$current_stage,   runtime_summary = NULL )"},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"arguments-9","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synchronous Workflow Scheduler — Scheduler","text":"error condition character, error caused suspension (default: private$.last_error) state_name character, state caused suspension stage character, stage suspension occurred (default: self$current_stage) runtime_summary list NULL, lightweight summary runtime failed (policy, agent, attempt, attachment_id). Used \"resume\" re-create runtime \"skip\" record skipped state.","code":""},{"path":"http://dipterix.org/tricobbler/reference/Scheduler.html","id":"returns-3","dir":"Reference","previous_headings":"","what":"Returns","title":"Synchronous Workflow Scheduler — Scheduler","text":"character, chosen action (invisibly)","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":null,"dir":"Reference","previous_headings":"","what":"Validated Dependency Declarations for State Policies — StateDeps","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"S7 class representing named list dependency declarations used StatePolicy@depends_on. entry maps parameter name prior state's output field.","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"","code":"StateDeps(..., .list = list())"},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"dependency-entry-format","dir":"Reference","previous_headings":"","what":"Dependency Entry Format","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"entry StateDeps object named list element : Name: parameter name passed agent function state: (required) Name state depend field: (optional) extract - \"result\" (default) \"description\" stage: (optional) Stage dependency. NULL omitted, dependency must stage higher priority. specified, must earlier stage workflow","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"same-stage-vs-cross-stage-dependencies","dir":"Reference","previous_headings":"","what":"Same-Stage vs Cross-Stage Dependencies","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"-stage (stage = NULL): dependent state must higher priority (lower number = runs later). ensures dependency executes dependent within parallel priority groups Cross-stage (stage = \"earlier_stage\"): dependency previous stage. Since stages execute sequentially, dependency guaranteed complete dependent stage begins","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"validation-rules-property-level-","dir":"Reference","previous_headings":"","what":"Validation Rules (Property-Level)","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"property-level validator checks structural correctness: Must named list (names become parameter names) entry must list required state field state must single non-blank character string field (present) must \"result\" \"description\" stage (present) must single character string NULL Parameter names must valid R identifiers","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"cross-validation-manifest-level-","dir":"Reference","previous_headings":"","what":"Cross-Validation (Manifest-Level)","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"Additional validation performed Manifest level check: Referenced states exist manifest -stage dependencies higher priority Cross-stage dependencies reference earlier stages","code":""},{"path":"http://dipterix.org/tricobbler/reference/StateDeps.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Validated Dependency Declarations for State Policies — StateDeps","text":"","code":"# Same-stage dependencies (state must have higher priority) deps <- StateDeps(   validation_result = list(state = \"validator\"),   parsed_data = list(state = \"parser\", field = \"result\") )  # Cross-stage dependency deps2 <- StateDeps(   plan = list(state = \"planner\", field = \"result\", stage = \"planning\") )  # Empty dependencies (valid) empty_deps <- StateDeps()"},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":null,"dir":"Reference","previous_headings":"","what":"State-Level Policy Implementation for Workflow Stages — StatePolicy","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"Represents single workflow state. Inherits BasePolicy adds mandatory stage must match one stages defined MasterPolicy. Includes priority criticality flags execution ordering multiple states share stage.","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"","code":"StatePolicy(   name = character(0),   description = character(0),   stage = character(0),   agent_id = character(0),   resources = character(0),   accessibility = \"all\",   parameters = list(),   max_retry = 0L,   priority = 100L,   critical = FALSE,   final = FALSE,   on_failure = NA_character_,   depends_on = StateDeps() )"},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"name character, name state policy (non-blank) description character, human-readable description stage character, must non-blank single string agent_id character, unique identifier agent responsible executing state. Must contain letters, digits, underscores, dashes resources character vector, tools agent may call execution (default empty vector) accessibility character, context accessibility level agent. Controls context data agent can read. One \"\" (full access), \"logs\" (logs ), \"none\" (access), \"explicit\" (use depends_on specify inputs; depends_on empty, behaves like \"logs\"). Default \"\" parameters list, state-specific parameters passed agent. See Parameters Different Agent Types Details max_retry integer, maximum total attempts (initial + retries) state stage execution (default 0, meaning single attempt). max_retry limit applies globally across re-entries state within stage. on_failure set, state retry locally jump failure handler immediately. on_failure NA, local retries max_retry attempted moving next state priority integer, execution priority (0-999, default 100). Higher values run first (999 = highest priority, 0 = lowest). Used multiple states share stage. NA NULL treated 100 critical logical, TRUE, states lower priority execute state fails (default FALSE). Critical states must priority >= 1 share priority code states final logical, TRUE validation succeeds, skip remaining states workflow (default FALSE) on_failure character, name state jump first failure (default NA retry locally max_retry times). set, failures trigger immediate jump specified state without local retries. max_retry limit still applies globally prevent infinite loops: state re-entered total attempts exceed max_retry, execution stops error. Common patterns: validation loops (on_failure = \"executor\"), alternative strategies (on_failure = \"slower_alternative\"), repair chains (on_failure = \"repair_step\") depends_on StateDeps object named list specifying explicit dependencies prior state outputs. entry maps parameter name dependency: list(param = list(state = \"state_name\", field =   \"result\", stage = NULL)). Used accessibility = \"explicit\" async execution. See StateDeps format details","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"stages-vs-states","dir":"Reference","previous_headings":"","what":"Stages vs States","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"Stage (macro): workflow phase name MasterPolicy@stages (e.g., \"executing\") State (micro): concrete StatePolicy implementation stage Multiple states can reference stage different execution patterns","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"priority-system-and-execution-patterns","dir":"Reference","previous_headings":"","what":"Priority System and Execution Patterns","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"multiple states share stage, execution pattern depends priority: Range: 0 (lowest) 999 (highest) Default: 100 (priority = NA NULL) Execution order: States run sequentially priority (higher first)","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"critical-flag-enforcing-sequential-execution","dir":"Reference","previous_headings":"","what":"Critical Flag: Enforcing Sequential Execution","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"critical flag enforces sequential execution fail-fast semantics: critical = TRUE, state must execute succeed lower-priority states stage can run critical state fails, lower-priority states skipped entirely Critical states must unique priority (enforced Manifest) Critical states must priority >= 1 (lowest priority 0) Critical states share priority value states stage (enforced Manifest validation) Use case: Required validation gates must pass alternatives run","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"when-to-use-multiple-states-per-stage","dir":"Reference","previous_headings":"","what":"When to Use Multiple States Per Stage","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"Create multiple StatePolicy objects stage need: Fallback chains: Different priorities create ordered execution alternative strategies Alternative implementations: Multiple states stage execution alternative strategies (e.g., primary approach -> fallback -> last resort) Critical validation gates: Critical state must succeed lower-priority alternatives execute (enforces sequential, fail-fast semantics) Phased deployment: Gradually shift priority new implementations mature","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"parameters-for-different-agent-types","dir":"Reference","previous_headings":"","what":"Parameters for Different Agent Types","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"parameters list interpreted differently based agent type created via as_agent: Deterministic Agents (functions MCP tools): args: list, function arguments passed via .call(fun, args). Kept separate parameters avoid conflicts functions reserved arguments accessibility property affects inputs constructed: \"\": First argument previous agent's result (last_attachment$result), followed args \"logs\": First argument previous agent's description (last_attachment$description), followed args \"none\": args passed (context access) Debug Mode: Set context$debug <- TRUE runtime enable debug mode. debug mode, agents print calls/tools inspection run -op (returning debug information instead executing). AI Agents (ellmer Chat objects): system_prompt: character, additional system prompt appended @description user_prompt: character, user message send LLM keep_turns: logical, TRUE, retains conversation history across executions (default FALSE) return_type: ellmer type indicator (e.g., ellmer::type_object()). provided, triggers chat$chat_structured(type = return_type) structured output. Can also specified YAML via map_type_to_ellmer()","code":""},{"path":"http://dipterix.org/tricobbler/reference/StatePolicy.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"State-Level Policy Implementation for Workflow Stages — StatePolicy","text":"","code":"# Basic state StatePolicy(   name = \"state1\",   stage = \"idle\",   description = \"initial idle state\",   agent_id = \"agent1\",   parameters = list() ) #> StatePolicy (S7 class) - `state1` (idle) #> initial idle state  # Critical high-priority state StatePolicy(   name = \"validator\",   stage = \"executing\",   description = \"critical validation step\",   agent_id = \"validator_agent\",   priority = 900,   critical = TRUE ) #> StatePolicy (S7 class) - `validator` (executing) #> critical validation step  # Deterministic agent with parameters StatePolicy(   name = \"formatter\",   stage = \"executing\",   description = \"Format data to JSON\",   agent_id = \"json_formatter\",   accessibility = \"none\",  # Only use args, no context   parameters = list(     args = list(x = list(a = 1, b = 2), pretty = TRUE)   ) ) #> StatePolicy (S7 class) - `formatter` (executing) #> Format data to JSON  # AI agent with structured output StatePolicy(   name = \"planner\",   stage = \"planning\",   description = \"Break down the task into steps\",   agent_id = \"llm_planner\",   parameters = list(     system_prompt = \"You are a task planning expert.\",     user_prompt = \"Plan the following task: ...\",     keep_turns = FALSE,     return_type = ellmer::type_object(       steps = ellmer::type_array(items = ellmer::type_string())     )   ) ) #> StatePolicy (S7 class) - `planner` (planning) #> Break down the task into steps"},{"path":"http://dipterix.org/tricobbler/reference/as_agent.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Objects to Agent — as_agent","title":"Convert Objects to Agent — as_agent","text":"Generic function convert various object types Agent objects use Scheduler. Supports conversion ellmer Chat objects, functions, MCP tool specifications, package function references.","code":""},{"path":"http://dipterix.org/tricobbler/reference/as_agent.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Objects to Agent — as_agent","text":"","code":"as_agent(x, ...)"},{"path":"http://dipterix.org/tricobbler/reference/as_agent.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Objects to Agent — as_agent","text":"x Object convert. Can : Agent object (returned -) ellmer Chat object (creates LLM-backed agent) function signature function(runtime), runtime AgentRuntime object character string referencing package function (\"pkg::fun\") MCP tool definition (class tricobbler_mcp_tool) ... Additional arguments passed methods. Common arguments include id (character, unique agent identifier), description (character, human-readable description), describe (function, result formatting logging; defaults mcp_describe).","code":""},{"path":"http://dipterix.org/tricobbler/reference/as_agent.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Objects to Agent — as_agent","text":"Agent object.","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/as_agent.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Objects to Agent — as_agent","text":"","code":"# From a simple function my_func <- function(runtime) {   runtime$logger(\"Hello from my agent!\")   return(\"done\") } agent <- as_agent(my_func)   if (FALSE) { # \\dontrun{ # From an ellmer Chat (requires API credentials) chat <- ellmer::chat_openai(model = \"gpt-4o-mini\") agent <- as_agent(chat)  # From a package function reference agent <- as_agent(\"utils::read.csv\", id = \"mean_agent\") } # }"},{"path":"http://dipterix.org/tricobbler/reference/manifest-file.html","id":null,"dir":"Reference","previous_headings":"","what":"Read or Write Manifest from or to a YAML File — manifest-file","title":"Read or Write Manifest from or to a YAML File — manifest-file","text":"Serialize read Manifest objects YAML files. enables version control sharing workflow policy definitions. resulting YAML files human-readable can edited manually, though changes must still pass validation read back. manifest_write() serializes Manifest object YAML file. manifest_read() reads YAML file back validated Manifest object, reconstructing MasterPolicy StatePolicy objects enforcing validation rules (e.g., every stage must corresponding state).","code":""},{"path":"http://dipterix.org/tricobbler/reference/manifest-file.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read or Write Manifest from or to a YAML File — manifest-file","text":"","code":"manifest_write(x, file, ...)  manifest_read(file, ...)"},{"path":"http://dipterix.org/tricobbler/reference/manifest-file.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read or Write Manifest from or to a YAML File — manifest-file","text":"x Manifest object serialize (manifest_write) file Character. Path YAML file (input manifest_read, output manifest_write). ... Additional arguments passed yaml::read_yaml() yaml::write_yaml().","code":""},{"path":"http://dipterix.org/tricobbler/reference/manifest-file.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Read or Write Manifest from or to a YAML File — manifest-file","text":"manifest_write(): Invisibly returns path written file. manifest_read(): validated Manifest object","code":""},{"path":"http://dipterix.org/tricobbler/reference/manifest-file.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Read or Write Manifest from or to a YAML File — manifest-file","text":"","code":"# Create a manifest mp <- MasterPolicy(   name = \"demo-workflow\",   version = \"1.0.0\",   stages = c(\"idle\", \"working\"),   parameters = list(timeout = 300) ) sp1 <- StatePolicy(   name = \"init\", stage = \"idle\",   description = \"Initial state\", agent_id = \"agent_init\" ) sp2 <- StatePolicy(   name = \"process\", stage = \"working\",   description = \"Processing state\", agent_id = \"agent_process\" ) manifest <- Manifest(master = mp, states = list(sp1, sp2))  # Write to temporary file tmp <- tempfile(fileext = \".yaml\") manifest_write(manifest, tmp)  # Verify file exists file.exists(tmp) #> [1] TRUE  # Read it back manifest2 <- manifest_read(tmp)  # Verify the name matches manifest2@name == \"demo-workflow\" #> [1] TRUE  # Clean up unlink(tmp)"},{"path":"http://dipterix.org/tricobbler/reference/map_type_to_ellmer.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","title":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","text":"Converts JSON Schema type definitions (YAML lists) ellmer type indicator objects use chat$chat_structured().","code":""},{"path":"http://dipterix.org/tricobbler/reference/map_type_to_ellmer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","text":"","code":"map_type_to_ellmer(type_def)"},{"path":"http://dipterix.org/tricobbler/reference/map_type_to_ellmer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","text":"type_def list representing JSON Schema type definition, character string specifying simple type (e.g., \"string\", \"integer\"). Supported types: \"string\", \"integer\", \"number\", \"boolean\", \"array\", \"object\". Arrays can specify items element types. Objects can specify properties nested structure.","code":""},{"path":"http://dipterix.org/tricobbler/reference/map_type_to_ellmer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","text":"ellmer type indicator object (e.g., ellmer::type_string(), ellmer::type_object()).","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/map_type_to_ellmer.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Type Definitions to ellmer Type Indicators — map_type_to_ellmer","text":"","code":"if (FALSE) { # \\dontrun{ # Simple string type map_type_to_ellmer(\"string\")  # Complex object type from YAML-like definition map_type_to_ellmer(list(   type = \"object\",   properties = list(     name = list(type = \"string\", description = \"User name\"),     age = list(type = \"integer\", description = \"User age\")   ) )) } # }"},{"path":"http://dipterix.org/tricobbler/reference/mcp-tools.html","id":null,"dir":"Reference","previous_headings":"","what":"MCP tool extraction and type inference — mcp-tools","title":"MCP tool extraction and type inference — mcp-tools","text":"MCP tool extraction type inference","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":null,"dir":"Reference","previous_headings":"","what":"Attach Context to Chat Messages — mcp_attach","title":"Attach Context to Chat Messages — mcp_attach","text":"Formats R objects combines optional text attach context chat messages. Similar btw::btw(), function wraps formatted output structured format chat models can easily understand. function uses mcp_describe internally format objects human-readable text, wraps output code blocks returns ellmer::ContentText object suitable use ellmer::Chat$chat().","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Attach Context to Chat Messages — mcp_attach","text":"","code":"mcp_attach(..., .header = \"## Context\", .wrap_code = TRUE)"},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Attach Context to Chat Messages — mcp_attach","text":"... R objects format, character strings include. argument formatted using mcp_describe() unless plain text string. .header Character string context header. Default: \"## Context\" .wrap_code Logical. Whether wrap non-text objects code blocks. Default: TRUE","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Attach Context to Chat Messages — mcp_attach","text":"ellmer::ContentText object containing formatted context. object can passed directly chat$chat().","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Attach Context to Chat Messages — mcp_attach","text":"function processes argument follows: Package references like \"{packagename}\" expanded show help topics package JSON format Plain text strings (single character vectors) used -R objects formatted using mcp_describe() Formatted objects wrapped code blocks .wrap_code = TRUE parts combined header single text block resulting ContentText object compatible ellmer chat functions automatically processed passed chat$chat().","code":""},{"path":[]},{"path":"http://dipterix.org/tricobbler/reference/mcp_attach.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Attach Context to Chat Messages — mcp_attach","text":"","code":"# Single object mcp_attach(sessionInfo()) #> <ellmer::ContentText> #>  @ text: chr \"## Context\\n\\n```r\\nR version 4.5.2 (2025-10-31)\\n```\\n```r\\nPlatform: x86_64-pc-linux-gnu\\n```\\n```r\\nRunning \"| __truncated__  # Package help topics mcp_attach(\"{tricobbler}\") #> <ellmer::ContentText> #>  @ text: chr \"## Context\\n\\n{tricobbler}\\n```json\\n[{\\\"topic_id\\\":[\\\"Agent\\\"],\\\"title\\\":[\\\"Agent Function Wrapper for State E\"| __truncated__  # Multiple objects with question mcp_attach(sessionInfo(), mtcars, \"What packages and data are available?\") #> <ellmer::ContentText> #>  @ text: chr \"## Context\\n\\n```r\\nR version 4.5.2 (2025-10-31)\\n```\\n```r\\nPlatform: x86_64-pc-linux-gnu\\n```\\n```r\\nRunning \"| __truncated__  if (FALSE) { # \\dontrun{ # Use in chat chat <- ellmer::chat_anthropic() response <- chat$chat(   mcp_attach(sessionInfo(), \"What R version am I using?\") ) } # }"},{"path":"http://dipterix.org/tricobbler/reference/mcp_describe.html","id":null,"dir":"Reference","previous_headings":"","what":"Describe an R object for use in MCP tools — mcp_describe","title":"Describe an R object for use in MCP tools — mcp_describe","text":"S7 generic function used describe R object way can safely serialized JSON sent MCP clients. Unlike direct serialization, function handles special objects (environments, external pointers, large objects) generating human-readable descriptions. maximum print size controlled context cache setting tricobbler.mcp_describe.max_size (default: 100 lines).","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_describe.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Describe an R object for use in MCP tools — mcp_describe","text":"","code":"mcp_describe(x, ...)"},{"path":"http://dipterix.org/tricobbler/reference/mcp_describe.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Describe an R object for use in MCP tools — mcp_describe","text":"x object describe. ... Additional arguments passed underlying methods. Unused arguments silently ignored.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_describe.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Describe an R object for use in MCP tools — mcp_describe","text":"character vector lines describing object. object simple scalar, may return single-element character vector. ellmer::Content objects, returns object -.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcp_describe.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Describe an R object for use in MCP tools — mcp_describe","text":"","code":"# Describe a data frame mcp_describe(mtcars) #>  [1] \"                   mpg cyl  disp  hp drat    wt  qsec vs am gear carb\" #>  [2] \"Mazda RX4         21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4\" #>  [3] \"Mazda RX4 Wag     21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4\" #>  [4] \"Datsun 710        22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1\" #>  [5] \"Hornet 4 Drive    21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1\" #>  [6] \"Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2\" #>  [7] \"Valiant           18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1\" #>  [8] \"Duster 360        14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4\" #>  [9] \"Merc 240D         24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2\" #> [10] \"Merc 230          22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2\" #> [11] \" [ reached 'max' / getOption(\\\"max.print\\\") -- omitted 23 rows ]\"       # Describe a function mcp_describe(mean) #> [1] \"function (x, ...) \"  \"UseMethod(\\\"mean\\\")\"  # Describe a matrix mcp_describe(matrix(1:12, 3, 4)) #> [1] \"     [,1] [,2] [,3] [,4]\" \"[1,]    1    4    7   10\" #> [3] \"[2,]    2    5    8   11\" \"[3,]    3    6    9   12\""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_build.html","id":null,"dir":"Reference","previous_headings":"","what":"Build MCP Tool Definitions from Package Documentation — mcptool_build","title":"Build MCP Tool Definitions from Package Documentation — mcptool_build","text":"Helper function developers scan package's R source files functions marked @keywords mcp-tool generates YAML tool definitions inst/mcp/tools/. Run documenting package.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_build.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Build MCP Tool Definitions from Package Documentation — mcptool_build","text":"","code":"mcptool_build(path = \".\", verbose = TRUE)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_build.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Build MCP Tool Definitions from Package Documentation — mcptool_build","text":"path Character. Path package root directory (default: .) verbose Logical. Print progress messages (default: TRUE)","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_build.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Build MCP Tool Definitions from Package Documentation — mcptool_build","text":"Invisibly returns list generated tool definitions","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_build.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Build MCP Tool Definitions from Package Documentation — mcptool_build","text":"","code":"if (FALSE) { # \\dontrun{  # After documenting your package `devtools::document()`  mcptool_build()  } # }"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_instantiate.html","id":null,"dir":"Reference","previous_headings":"","what":"Instantiate from RAVE MCP tool definition — mcptool_instantiate","title":"Instantiate from RAVE MCP tool definition — mcptool_instantiate","text":"Create ellmer tool object loaded RAVE MCP tool definition. allows using RAVE pipelines tools directly via ellmer package.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_instantiate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Instantiate from RAVE MCP tool definition — mcptool_instantiate","text":"","code":"mcptool_instantiate(tool, ..., runtime = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_instantiate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Instantiate from RAVE MCP tool definition — mcptool_instantiate","text":"tool object class tricobbler_mcp_tool (loaded via mcptool_read mcptool_load_all). ... Additional arguments passed tool. runtime AgentRuntime object NULL (default). provided, MCP tools declare .runtime parameter receive runtime automatically via closure capture. enables async-safe execution without relying global state.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_instantiate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Instantiate from RAVE MCP tool definition — mcptool_instantiate","text":"ToolDef object ready registered chat session.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_list.html","id":null,"dir":"Reference","previous_headings":"","what":"List MCP tool names from a package or directory — mcptool_list","title":"List MCP tool names from a package or directory — mcptool_list","text":"Lists available MCP tool names package directory. lightweight wrapper around mcptool_load_all returns tool names without loading full definitions.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_list.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List MCP tool names from a package or directory — mcptool_list","text":"","code":"mcptool_list(pkg, groups = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_list.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List MCP tool names from a package or directory — mcptool_list","text":"pkg Character. Package name path tools directory. pkg contains path separators, space, '.', treated directory path. Otherwise, treated package name. groups Character vector NULL. Optional group filter(s) list tools specific group(s). Groups extracted tool names following pattern pkg-mcp_tool_{group}_{action}. group can regexp pattern. NULL (default), tools listed.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_list.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"List MCP tool names from a package or directory — mcptool_list","text":"Character vector tool names (format pkg-function_name). Returns empty character vector tools found.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_list.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"List MCP tool names from a package or directory — mcptool_list","text":"","code":"# List all tools from package mcptool_list(\"tricobbler\") #>  [1] \"tricobbler-mcp_tool_config_set_outputs\"        #>  [2] \"tricobbler-mcp_tool_context_attachment_exists\" #>  [3] \"tricobbler-mcp_tool_context_attachment_get\"    #>  [4] \"tricobbler-mcp_tool_context_attachment_list\"   #>  [5] \"tricobbler-mcp_tool_context_logs_head\"         #>  [6] \"tricobbler-mcp_tool_context_logs_search\"       #>  [7] \"tricobbler-mcp_tool_context_logs_tail\"         #>  [8] \"tricobbler-mcp_tool_docs_available_vignettes\"  #>  [9] \"tricobbler-mcp_tool_docs_help_page\"            #> [10] \"tricobbler-mcp_tool_docs_package_help_topics\"  #> [11] \"tricobbler-mcp_tool_docs_vignette\"             #> [12] \"tricobbler-mcp_tool_read_package_file\"         #> [13] \"tricobbler-mcp_tool_run_r\"                     #> [14] \"tricobbler-mcp_tool_search_package_files\"      #> [15] \"tricobbler-mcp_tool_search_package_info\"       #> [16] \"tricobbler-mcp_tool_search_packages\"            # List only pipeline group tools mcptool_list(\"tricobbler\", groups = \"pipeline\") #> NULL  # List multiple groups mcptool_list(\"tricobbler\", groups = c(\"pipeline\", \"config\")) #> [1] \"tricobbler-mcp_tool_config_set_outputs\"  # Or list tools from directory path <- system.file(\"mcp\", \"tools\", package = \"tricobbler\") mcptool_list(path) #>  [1] \"tricobbler-mcp_tool_config_set_outputs\"        #>  [2] \"tricobbler-mcp_tool_context_attachment_exists\" #>  [3] \"tricobbler-mcp_tool_context_attachment_get\"    #>  [4] \"tricobbler-mcp_tool_context_attachment_list\"   #>  [5] \"tricobbler-mcp_tool_context_logs_head\"         #>  [6] \"tricobbler-mcp_tool_context_logs_search\"       #>  [7] \"tricobbler-mcp_tool_context_logs_tail\"         #>  [8] \"tricobbler-mcp_tool_docs_available_vignettes\"  #>  [9] \"tricobbler-mcp_tool_docs_help_page\"            #> [10] \"tricobbler-mcp_tool_docs_package_help_topics\"  #> [11] \"tricobbler-mcp_tool_docs_vignette\"             #> [12] \"tricobbler-mcp_tool_read_package_file\"         #> [13] \"tricobbler-mcp_tool_run_r\"                     #> [14] \"tricobbler-mcp_tool_search_package_files\"      #> [15] \"tricobbler-mcp_tool_search_package_info\"       #> [16] \"tricobbler-mcp_tool_search_packages\""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_load_all.html","id":null,"dir":"Reference","previous_headings":"","what":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","title":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","text":"Load MCP Tool Definitions Package Directory","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_load_all.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","text":"","code":"mcptool_load_all(pkg, groups = NULL)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_load_all.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","text":"pkg Character. Package name path tools directory. pkg contains path separators, space, ., treated directory path. Otherwise, treated package name. groups Character vector NULL. Optional group filter(s) load tools specific group(s). Groups extracted tool names following pattern pkg-mcp_tool_{group}_{action}. group can regexp pattern. example, \"pipeline\", \"config\", \"(pipeline|config)\". NULL (default), tools loaded.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_load_all.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","text":"List MCP tool definitions","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_load_all.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load MCP Tool Definitions from Package or Directory — mcptool_load_all","text":"","code":"# Load all tools from package tools <- mcptool_load_all(\"tricobbler\")  # Load only pipeline group tools pipeline_tools <- mcptool_load_all(\"tricobbler\", groups = \"pipeline\")  # Load multiple groups tools <- mcptool_load_all(\"tricobbler\", groups = c(\"pipeline\", \"config\"))  # Load from directory path <- system.file(\"mcp\", \"tools\", package = \"tricobbler\") tools <- mcptool_load_all(path)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_path.html","id":null,"dir":"Reference","previous_headings":"","what":"Find path to a specific MCP tool by name — mcptool_path","title":"Find path to a specific MCP tool by name — mcptool_path","text":"Locates MCP tool YAML file either installed package local directory. Tool names use pkg-function_name format first hyphen separates package name function name. Returns file path tool definition attached attribute.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_path.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find path to a specific MCP tool by name — mcptool_path","text":"","code":"mcptool_path(tool_name, tools_dir = \"../tools\")"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_path.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find path to a specific MCP tool by name — mcptool_path","text":"tool_name Character. Tool name format pkg-function_name. first hyphen separates package name function name (function names may contain hyphens). tools_dir Character. Path root directory local tools look-. Default \"../tools\" (relative workflows directory).","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_path.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find path to a specific MCP tool by name — mcptool_path","text":"Character string containing path tool YAML file, attribute mcp_definition containing parsed tool definition. Throws error tool found.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_path.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Find path to a specific MCP tool by name — mcptool_path","text":"","code":"# Find tool from package tool_path <- mcptool_path(\"tricobbler-mcp_tool_search_packages\") attr(tool_path, \"mcp_definition\") #> $name #> [1] \"tricobbler-mcp_tool_search_packages\" #>  #> $description #> [1] \"Search for R packages that match a keyword or pattern in their name, title, or description. Searches CRAN package database for matches. Useful for discovering packages related to a specific topic.\" #>  #> $parameters #> $parameters$type #> [1] \"object\" #>  #> $parameters$properties #> $parameters$properties$max_results #> $parameters$properties$max_results$type #> [1] \"integer\" #>  #> $parameters$properties$max_results$description #> [1] \"Maximum number of results to return. Default is 20. Use this to limit output size for broad searches. Example values: 10, 50, 100.\" #>  #> $parameters$properties$max_results$default #> [1] 20 #>  #> $parameters$properties$max_results$examples #> [1] \"10\"  \"50\"  \"100\" #>  #>  #> $parameters$properties$query #> $parameters$properties$query$type #> [1] \"string\" #>  #> $parameters$properties$query$description #> [1] \"The search query. Can be a keyword, partial package name, or topic. The search is case-insensitive and matches against package names, titles, and descriptions. Examples: \\\"pipeline\\\", \\\"visualization\\\", \\\"data\\\".\" #>  #>  #>  #> $parameters$required #> [1] \"query\" #>  #>  #> $category #> [1] \"discovery\" #>  #> $returns #> $returns$type #> [1] \"object\" #>  #> $returns$properties #> $returns$properties$error #> $returns$properties$error$type #> [1] \"string\" #>  #> $returns$properties$error$description #> [1] \"Character, error message if success is FALSE\" #>  #>  #> $returns$properties$returned #> $returns$properties$returned$type #> [1] \"integer\" #>  #> $returns$properties$returned$description #> [1] \"Integer, number of results returned (limited by max_results)\" #>  #>  #> $returns$properties$count #> $returns$properties$count$type #> [1] \"integer\" #>  #> $returns$properties$count$description #> [1] \"Integer, total number of packages matching the query\" #>  #>  #> $returns$properties$packages #> $returns$properties$packages$type #> [1] \"object\" #>  #> $returns$properties$packages$description #> [1] \"Data frame with columns package (package name), version (version string), title (package title), description (brief description), date (publication date), and maintainer (maintainer name)\" #>  #>  #> $returns$properties$query #> $returns$properties$query$type #> [1] \"string\" #>  #> $returns$properties$query$description #> [1] \"Character, the search query that was used\" #>  #>  #> $returns$properties$success #> $returns$properties$success$type #> [1] \"boolean\" #>  #> $returns$properties$success$description #> [1] \"Logical, whether the search completed successfully\" #>  #>  #>  #>  #> $implementation_example #> [1] \"# Example output from calling the tool\\ntricobbler:::mcp_tool_search_packages(\\\"tricobbler\\\")\\n#\\n#> $success\\n#> [1] TRUE\\n#> \\n#> $query\\n#> [1] \\\"tricobbler\\\"\\n#> \\n#> $packages\\n#> [1] package     version     title       description date        maintainer \\n#> <0 rows> (or 0-length row.names)\\n#> \\n#> $count\\n#> [1] 0\\n#> \\n#> $returned\\n#> [1] 0\\n#> \\n#> $message\\n#> [1] \\\"No packages found matching query: tricobbler\\\"\\n#>\\n\" #>  #> $execution_time #> [1] 0.542 #>  #> attr(,\"class\") #> [1] \"tricobbler_mcp_tool\" \"list\"                  if (FALSE) { # \\dontrun{  # Simple tool name (looks in tools_dir only) tool_path <- mcptool_path(\"my_tool\", tools_dir = \"./tools\")  } # }"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_read.html","id":null,"dir":"Reference","previous_headings":"","what":"Read MCP tool definition from YAML file — mcptool_read","title":"Read MCP tool definition from YAML file — mcptool_read","text":"Reads parses MCP tool definition YAML file. low-level function used internally mcptool_load_all mcptool_path.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_read.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read MCP tool definition from YAML file — mcptool_read","text":"","code":"mcptool_read(path, check = FALSE, resolve = TRUE)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_read.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read MCP tool definition from YAML file — mcptool_read","text":"path Character. Path YAML file containing tool definition. check Logical. Whether check function definition exists; default FALSE resolve Logical. Whether try resolving path, allowing package tools loaded package-function_name syntax; default TRUE; set FALSE path treated file path without resolving.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_read.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Read MCP tool definition from YAML file — mcptool_read","text":"List containing parsed tool definition. Throws error file read parsed.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_read.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Read MCP tool definition from YAML file — mcptool_read","text":"","code":"# Read directly from package using \\verb{MCP} tool name mcptool_read(\"tricobbler-mcp_tool_search_packages\") #> $name #> [1] \"tricobbler-mcp_tool_search_packages\" #>  #> $description #> [1] \"Search for R packages that match a keyword or pattern in their name, title, or description. Searches CRAN package database for matches. Useful for discovering packages related to a specific topic.\" #>  #> $parameters #> $parameters$type #> [1] \"object\" #>  #> $parameters$properties #> $parameters$properties$max_results #> $parameters$properties$max_results$type #> [1] \"integer\" #>  #> $parameters$properties$max_results$description #> [1] \"Maximum number of results to return. Default is 20. Use this to limit output size for broad searches. Example values: 10, 50, 100.\" #>  #> $parameters$properties$max_results$default #> [1] 20 #>  #> $parameters$properties$max_results$examples #> [1] \"10\"  \"50\"  \"100\" #>  #>  #> $parameters$properties$query #> $parameters$properties$query$type #> [1] \"string\" #>  #> $parameters$properties$query$description #> [1] \"The search query. Can be a keyword, partial package name, or topic. The search is case-insensitive and matches against package names, titles, and descriptions. Examples: \\\"pipeline\\\", \\\"visualization\\\", \\\"data\\\".\" #>  #>  #>  #> $parameters$required #> [1] \"query\" #>  #>  #> $category #> [1] \"discovery\" #>  #> $returns #> $returns$type #> [1] \"object\" #>  #> $returns$properties #> $returns$properties$error #> $returns$properties$error$type #> [1] \"string\" #>  #> $returns$properties$error$description #> [1] \"Character, error message if success is FALSE\" #>  #>  #> $returns$properties$returned #> $returns$properties$returned$type #> [1] \"integer\" #>  #> $returns$properties$returned$description #> [1] \"Integer, number of results returned (limited by max_results)\" #>  #>  #> $returns$properties$count #> $returns$properties$count$type #> [1] \"integer\" #>  #> $returns$properties$count$description #> [1] \"Integer, total number of packages matching the query\" #>  #>  #> $returns$properties$packages #> $returns$properties$packages$type #> [1] \"object\" #>  #> $returns$properties$packages$description #> [1] \"Data frame with columns package (package name), version (version string), title (package title), description (brief description), date (publication date), and maintainer (maintainer name)\" #>  #>  #> $returns$properties$query #> $returns$properties$query$type #> [1] \"string\" #>  #> $returns$properties$query$description #> [1] \"Character, the search query that was used\" #>  #>  #> $returns$properties$success #> $returns$properties$success$type #> [1] \"boolean\" #>  #> $returns$properties$success$description #> [1] \"Logical, whether the search completed successfully\" #>  #>  #>  #>  #> $implementation_example #> [1] \"# Example output from calling the tool\\ntricobbler:::mcp_tool_search_packages(\\\"tricobbler\\\")\\n#\\n#> $success\\n#> [1] TRUE\\n#> \\n#> $query\\n#> [1] \\\"tricobbler\\\"\\n#> \\n#> $packages\\n#> [1] package     version     title       description date        maintainer \\n#> <0 rows> (or 0-length row.names)\\n#> \\n#> $count\\n#> [1] 0\\n#> \\n#> $returned\\n#> [1] 0\\n#> \\n#> $message\\n#> [1] \\\"No packages found matching query: tricobbler\\\"\\n#>\\n\" #>  #> $execution_time #> [1] 0.542 #>  #> attr(,\"class\") #> [1] \"tricobbler_mcp_tool\" \"list\"                  path <- system.file(   \"mcp\", \"tools\", \"tricobbler-mcp_tool_search_packages.yaml\",   package = \"tricobbler\" )  tool_def <- mcptool_read(path, resolve = FALSE)  # Check tool name and description tool_def$name #> [1] \"tricobbler-mcp_tool_search_packages\" tool_def$description #> [1] \"Search for R packages that match a keyword or pattern in their name, title, or description. Searches CRAN package database for matches. Useful for discovering packages related to a specific topic.\""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_write.html","id":null,"dir":"Reference","previous_headings":"","what":"Write MCP tool definition to file — mcptool_write","title":"Write MCP tool definition to file — mcptool_write","text":"Writes MCP tool definition file either YAML Markdown format.","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_write.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Write MCP tool definition to file — mcptool_write","text":"","code":"mcptool_write(tool, path, method = c(\"yaml\", \"markdown\"), ...)"},{"path":"http://dipterix.org/tricobbler/reference/mcptool_write.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Write MCP tool definition to file — mcptool_write","text":"tool tricobbler_mcp_tool object path Character. Path output file method Character. Output format: \"yaml\" (default) \"markdown\" ... Additional arguments (currently unused)","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_write.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Write MCP tool definition to file — mcptool_write","text":"Invisibly returns input tool object","code":""},{"path":"http://dipterix.org/tricobbler/reference/mcptool_write.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Write MCP tool definition to file — mcptool_write","text":"","code":"# Load a tool from package path <- mcptool_path(\"tricobbler-mcp_tool_search_packages\") tool <- mcptool_read(path)  # Write as YAML to temporary file mcptool_write(tool, stdout(), method = \"yaml\") #> name: tricobbler-mcp_tool_search_packages #> description: Search for R packages that match a keyword or pattern in their name, #>   title, or description. Searches CRAN package database for matches. Useful for discovering #>   packages related to a specific topic. #> parameters: #>   type: object #>   properties: #>     max_results: #>       type: integer #>       description: 'Maximum number of results to return. Default is 20. Use this to #>         limit output size for broad searches. Example values: 10, 50, 100.' #>       default: 20.0 #>       examples: #>       - '10' #>       - '50' #>       - '100' #>     query: #>       type: string #>       description: 'The search query. Can be a keyword, partial package name, or topic. #>         The search is case-insensitive and matches against package names, titles, #>         and descriptions. Examples: \"pipeline\", \"visualization\", \"data\".' #>   required: query #> category: discovery #> returns: #>   type: object #>   properties: #>     error: #>       type: string #>       description: Character, error message if success is FALSE #>     returned: #>       type: integer #>       description: Integer, number of results returned (limited by max_results) #>     count: #>       type: integer #>       description: Integer, total number of packages matching the query #>     packages: #>       type: object #>       description: Data frame with columns package (package name), version (version #>         string), title (package title), description (brief description), date (publication #>         date), and maintainer (maintainer name) #>     query: #>       type: string #>       description: Character, the search query that was used #>     success: #>       type: boolean #>       description: Logical, whether the search completed successfully #> implementation_example: \"# Example output from calling the tool\\ntricobbler:::mcp_tool_search_packages(\\\"tricobbler\\\")\\n#\\n#> #>   $success\\n#> [1] TRUE\\n#> \\n#> $query\\n#> [1] \\\"tricobbler\\\"\\n#> \\n#> $packages\\n#> #>   [1] package     version     title       description date        maintainer \\n#> #>   <0 rows> (or 0-length row.names)\\n#> \\n#> $count\\n#> [1] 0\\n#> \\n#> $returned\\n#> #>   [1] 0\\n#> \\n#> $message\\n#> [1] \\\"No packages found matching query: tricobbler\\\"\\n#>\\n\" #> execution_time: 0.542  # Write as Markdown mcptool_write(tool, stdout(), method = \"markdown\") #> # tricobbler-mcp_tool_search_packages #>  #> Search for R packages that match a keyword or pattern in their name, title, or description. Searches CRAN package database for matches. Useful for discovering packages related to a specific topic. #>  #> ## Parameters #>  #> - **max_results** (integer, *optional*) #>   Maximum number of results to return. Default is 20. Use this to #>   limit output size for broad searches. Example values: 10, 50, 100. #>   Default: 20 #>  #> - **query** (string, **required**) #>   The search query. Can be a keyword, partial package name, or topic. #>   The search is case-insensitive and matches against package names, #>   titles, and descriptions. Examples: \"pipeline\", \"visualization\", #>   \"data\". #>  #> ## Returns #>  #> Type: `object` #>  #> ### Properties #>  #> - `error` (string): Character, error message if success is FALSE #>   Character, error message if success is FALSE #>  #> - `returned` (integer): Integer, number of results returned (limited by max_results) #>   Integer, number of results returned (limited by max_results) #>  #> - `count` (integer): Integer, total number of packages matching the query #>   Integer, total number of packages matching the query #>  #> - `packages` (object): Data frame with columns package (package name), version (version string), title (package title), description (brief description), date (publication date), and maintainer (maintainer name) #>   Data frame with columns package (package name), version (version #>   string), title (package title), description (brief description), #>   date (publication date), and maintainer (maintainer name) #>  #> - `query` (string): Character, the search query that was used #>   Character, the search query that was used #>  #> - `success` (boolean): Logical, whether the search completed successfully #>   Logical, whether the search completed successfully #>  #> ## Metadata #>  #> - **Category**: discovery #>"}]
